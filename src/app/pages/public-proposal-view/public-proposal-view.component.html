<!DOCTYPE html>
<div class="landing-page">
  
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-container">
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="hero-title">
            Mariana Naue criou a primeira consultoria
            especializada em mercado imobiliário do
            Brasil.
          </h1>
          <p class="hero-subtitle">
            Com metodologia própria e comprovada,
            transformamos mais de 1.500 líderes e
            centenas de construtoras, incorporadoras,
            loteadoras e imobiliárias em referências de
            mercado.
          </p>
        </div>
        <div class="hero-image">
          <img src="assets/images/naue.jpg" 
               alt="Mariana Naue" 
               class="naue-photo"
               (error)="onImageError($event)">
        </div>
      </div>
    </div>
  </section>

  <!-- Clients Carousel Section -->
  <section class="clients-section">
    <div class="clients-container">
      <h2 class="clients-title">Nossos Clientes</h2>
      <div class="clients-carousel">
        <div class="clients-track" [style.transform]="'translateX(' + carouselTransform + ')'">
          <div class="client-logo" *ngFor="let client of clients">
            <img [src]="client.logo" [alt]="client.name + ' logo'" (error)="onClientLogoError($event)">
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Loading State for Proposal -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Carregando sua proposta personalizada...</p>
    </div>
  </div>

  <!-- Proposal Content -->
  <section *ngIf="!isLoading && proposal" class="proposal-section">
    <div class="proposal-container">
      
      <!-- Proposal Header -->
      <div class="proposal-header">
        <div class="proposal-header-content">
          <h1 class="proposal-title">Sua Proposta Personalizada</h1>
          <p class="proposal-subtitle">
            Preparamos especialmente para você uma proposta sob medida
          </p>
        </div>
        
        <div class="proposal-status">
          <div class="status-badge" [ngClass]="'status-' + proposal.status">
            {{ getStatusText(proposal.status) }}
          </div>
          
          <div *ngIf="!proposalExpired && daysUntilExpiration !== null" class="validity-info">
            <i class="fas fa-clock"></i>
            <span *ngIf="daysUntilExpiration > 0">Válida por {{ daysUntilExpiration }} dias</span>
            <span *ngIf="daysUntilExpiration === 0" class="expiring-today">Expira hoje</span>
          </div>
          
          <div *ngIf="proposalExpired" class="validity-info expired">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Proposta expirada</span>
          </div>
        </div>
      </div>

      <!-- Services Section -->
      <div class="services-section">
        <h2 class="services-title">Serviços Inclusos</h2>
        <div class="services-grid">
          <div class="service-card" *ngFor="let service of proposal.services">
            <div class="service-header">
              <h3 class="service-name">{{ service.service.name }}</h3>
              <div class="service-price">
                <span class="price-value">{{ formatCurrency(getServiceTotal(service)) }}</span>
                <span class="price-label">{{ service.quantity > 1 ? service.quantity + 'x' : '' }}</span>
              </div>
            </div>
            <p *ngIf="service.service.description" class="service-description">
              {{ service.service.description }}
            </p>
            <div class="service-features">
              <div class="service-duration" *ngIf="service.service.duration_amount">
                <i class="fas fa-clock"></i>
                {{ service.service.duration_amount }} {{ service.service.duration_unit }}
              </div>
              <div class="service-category">
                <i class="fas fa-tag"></i>
                {{ service.service.category }}
              </div>
            </div>
          </div>
        </div>
        
        <div class="total-section">
          <div class="total-card">
            <div class="total-label">Valor Total da Proposta</div>
            <div class="total-value">{{ formatCurrency(proposal.total_value) }}</div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-section" *ngIf="currentStep === 'view' && proposal.status === 'sent' && !proposalExpired">
        <div class="action-buttons">
          <button class="btn btn-primary btn-large" (click)="startServiceSelection()">
            <i class="fas fa-check"></i>
            Aceitar Proposta
          </button>
          <button class="btn btn-secondary btn-large" (click)="rejectProposal()">
            <i class="fas fa-times"></i>
            Recusar Proposta
          </button>
        </div>
      </div>

    </div>
  </section>

  <!-- Service Selection Step -->
  <section *ngIf="currentStep === 'selecting' && proposal" class="step-section">
    <div class="step-container">
      <div class="step-header">
        <h2>Personalizar Serviços</h2>
        <p>Selecione os serviços que deseja incluir em seu projeto</p>
      </div>
      
      <div class="services-selection">
        <div class="service-item" *ngFor="let service of proposal.services">
          <div class="service-checkbox">
            <input 
              type="checkbox" 
              [id]="'service-' + service.service_id"
              [checked]="isServiceSelected(service.service_id)"
              (change)="toggleService(service.service_id)">
            <label [for]="'service-' + service.service_id">
              <div class="checkbox-content">
                <h3>{{ service.service.name }}</h3>
                <p>{{ service.service.description }}</p>
                <div class="service-price">{{ formatCurrency(getServiceTotal(service)) }}</div>
              </div>
            </label>
          </div>
          
          <div class="service-notes" *ngIf="isServiceSelected(service.service_id)">
            <label [for]="'notes-' + service.service_id">Observações específicas:</label>
            <textarea 
              [id]="'notes-' + service.service_id"
              [value]="getServiceNote(service.service_id)"
              (input)="updateServiceNoteFromEvent(service.service_id, $event)"
              placeholder="Adicione observações específicas para este serviço..."
              rows="3">
            </textarea>
          </div>
        </div>
      </div>

      <div class="selection-summary">
        <div class="summary-total">
          Total Selecionado: {{ formatCurrency(getSelectedTotal()) }}
        </div>
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" (click)="currentStep = 'view'">Voltar</button>
        <button class="btn btn-primary" [disabled]="!hasSelectedServices() || isSubmitting" (click)="saveServiceSelection()">
          <i *ngIf="isSubmitting" class="fas fa-spinner fa-spin"></i>
          <span *ngIf="!isSubmitting">Continuar para Assinatura</span>
          <span *ngIf="isSubmitting">Salvando...</span>
        </button>
      </div>
    </div>
  </section>

  <!-- Signature Step -->
  <section *ngIf="currentStep === 'signing'" class="step-section">
    <div class="step-container">
      <div class="step-header">
        <h2>Assinatura Digital</h2>
        <p>Finalize sua proposta com a assinatura digital</p>
      </div>

      <form [formGroup]="signatureForm" class="signature-form">
        <div class="form-grid">
          <div class="form-group">
            <label for="client_name">Nome Completo *</label>
            <input 
              type="text" 
              id="client_name" 
              formControlName="client_name"
              [class.error]="isFieldInvalid(signatureForm, 'client_name')">
            <div class="error-message" *ngIf="isFieldInvalid(signatureForm, 'client_name')">
              Nome é obrigatório
            </div>
          </div>

          <div class="form-group">
            <label for="client_email">Email *</label>
            <input 
              type="email" 
              id="client_email" 
              formControlName="client_email"
              [class.error]="isFieldInvalid(signatureForm, 'client_email')">
            <div class="error-message" *ngIf="isFieldInvalid(signatureForm, 'client_email')">
              Email válido é obrigatório
            </div>
          </div>

          <div class="form-group">
            <label for="client_phone">Telefone</label>
            <input 
              type="tel" 
              id="client_phone" 
              formControlName="client_phone">
          </div>

          <div class="form-group">
            <label for="client_document">CPF/CNPJ</label>
            <input 
              type="text" 
              id="client_document" 
              formControlName="client_document">
          </div>
        </div>

        <div class="signature-section">
          <label>Assinatura Digital *</label>
          <div class="signature-canvas-container">
            <canvas 
              #signatureCanvas
              class="signature-canvas"
              (mousedown)="startDrawing($event)"
              (mousemove)="draw($event)"
              (mouseup)="stopDrawing()"
              (touchstart)="startTouchDrawing($event)"
              (touchmove)="touchDraw($event)"
              (touchend)="stopTouchDrawing($event)">
            </canvas>
            <div class="signature-placeholder" *ngIf="!signatureDrawn">
              Assine aqui com o mouse ou toque
            </div>
          </div>
          <button type="button" class="btn btn-outline" (click)="clearSignature()">
            Limpar Assinatura
          </button>
        </div>

        <div class="step-actions">
          <button type="button" class="btn btn-secondary" (click)="currentStep = 'selecting'">Voltar</button>
          <button type="button" class="btn btn-primary" [disabled]="isSubmitting" (click)="signProposal()">
            <i *ngIf="isSubmitting" class="fas fa-spinner fa-spin"></i>
            <span *ngIf="!isSubmitting">Finalizar Proposta</span>
            <span *ngIf="isSubmitting">Processando...</span>
          </button>
        </div>
      </form>
    </div>
  </section>

  <!-- Confirmation Step -->
  <section *ngIf="currentStep === 'confirming'" class="step-section">
    <div class="step-container success-container">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2>Proposta Assinada!</h2>
      <p>Sua proposta foi assinada com sucesso. Em breve entraremos em contato para dar continuidade ao projeto.</p>
      
      <form [formGroup]="confirmationForm" class="confirmation-form">
        <div class="form-group">
          <label for="client_observations">Observações finais (opcional)</label>
          <textarea 
            id="client_observations" 
            formControlName="client_observations"
            placeholder="Adicione qualquer observação ou dúvida que tenha sobre o projeto..."
            rows="4">
          </textarea>
        </div>

        <div class="step-actions">
          <button type="button" class="btn btn-primary" [disabled]="isSubmitting" (click)="confirmProposal()">
            <i *ngIf="isSubmitting" class="fas fa-spinner fa-spin"></i>
            <span *ngIf="!isSubmitting">Finalizar</span>
            <span *ngIf="isSubmitting">Confirmando...</span>
          </button>
        </div>
      </form>
    </div>
  </section>

  <!-- Completed Step -->
  <section *ngIf="currentStep === 'completed' && proposal" class="step-section">
    <div class="step-container success-container">
      <div class="success-icon">
        <i class="fas fa-trophy"></i>
      </div>
      <h2>Parabéns!</h2>
      <p>Sua proposta foi aceita e processada com sucesso. Nossa equipe entrará em contato em breve para iniciar o projeto.</p>
      
      <div class="completion-info">
        <div class="info-item">
          <i class="fas fa-calendar-check"></i>
          <span>Proposta aceita em {{ getFormattedSignatureDate() }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-dollar-sign"></i>
          <span>Valor: {{ formatCurrency(getSelectedTotal() || proposal.total_value) }}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Rejected Step -->
  <section *ngIf="currentStep === 'rejected'" class="step-section">
    <div class="step-container">
      <div class="rejection-icon">
        <i class="fas fa-times-circle"></i>
      </div>
      <h2>Proposta Recusada</h2>
      <p>Obrigado por considerar nossa proposta. Se tiver alguma dúvida ou quiser discutir alternativas, entre em contato conosco.</p>
    </div>
  </section>

  <!-- Footer -->
  <footer class="landing-footer">
    <div class="footer-container">
      <div class="footer-content">
        <div class="footer-brand">
          <h3>NAUE Consultoria</h3>
          <p>Transformando o mercado imobiliário brasileiro</p>
        </div>
        <div class="footer-contact">
          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <span>contato&#64;naueconsultoria.com</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-phone"></i>
            <span>(11) 99999-9999</span>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; {{ currentYear }} NAUE Consultoria. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

</div>
