<app-breadcrumb></app-breadcrumb>

<!-- Controle de HÃ¡bitos - VersÃ£o atualizada -->
<div class="container">
  <h1>ðŸŒ± Controle de HÃ¡bitos</h1>
  <div class="period-display">{{ periodDisplay }}</div>

  <div class="controls">
    <div class="date-selectors">
      <input
        type="number"
        class="year-input"
        [(ngModel)]="currentYear"
        min="2000"
        max="2100"
        (change)="loadHabits()"
        placeholder="Ano">

      <select
        class="month-selector"
        [(ngModel)]="currentMonth"
        (change)="onMonthChange($any($event.target).value)">
        <option *ngFor="let month of monthOptions" [value]="month.index">
          {{ month.label }}
        </option>
      </select>
    </div>

    <button class="add-habit" (click)="openAddHabitModal()">+ Adicionar HÃ¡bito</button>

    <button class="export-btn" (click)="saveHabits()" [disabled]="isSaving">
      {{ isSaving ? 'ðŸ’¾ Salvando...' : 'ðŸ’¾ Salvar' }}
    </button>

    <button class="export-btn" (click)="exportData()">ðŸ“¥ Exportar</button>

    <label class="export-btn" style="cursor: pointer;">
      ðŸ“‚ Importar
      <input
        type="file"
        accept=".json"
        (change)="importData($event)"
        style="display: none;">
    </label>

    <button class="export-btn" (click)="resetMonth()">ðŸ”„ Limpar MÃªs</button>
  </div>

  <div class="statistics">
    <h2 style="color: #2e7d32; margin-bottom: 15px;">ðŸ“Š EstatÃ­sticas do MÃªs</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Total de HÃ¡bitos</h3>
        <p>{{ statistics.totalHabits }}</p>
      </div>
      <div class="stat-card">
        <h3>Metas AlcanÃ§adas</h3>
        <p>{{ statistics.completedGoals }}/{{ statistics.totalHabits }}</p>
      </div>
      <div class="stat-card">
        <h3>Total Realizado</h3>
        <p>{{ statistics.totalDone }}</p>
      </div>
      <div class="stat-card">
        <h3>Taxa de ConclusÃ£o</h3>
        <p>{{ statistics.completionRate }}%</p>
      </div>
    </div>
  </div>

  <div class="legend">
    <div class="legend-item">
      <div class="legend-box done"></div>
      <span>Feito</span>
    </div>
    <div class="legend-item">
      <div class="legend-box not-done"></div>
      <span>NÃ£o Feito</span>
    </div>
    <div class="legend-item">
      <div class="legend-box not-needed"></div>
      <span>NÃ£o NecessÃ¡rio</span>
    </div>
    <div class="legend-item">
      <div class="legend-box empty"></div>
      <span>Clique para alternar</span>
    </div>
  </div>

  <div class="loading-message" *ngIf="isLoading">
    <p>Carregando hÃ¡bitos...</p>
  </div>

  <div class="table-wrapper" *ngIf="!isLoading">
    <table>
      <thead>
        <tr>
          <th>HÃ¡bito</th>
          <th>Meta / Progresso</th>
          <th *ngFor="let day of dayNumbers">{{ day }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let habit of habits; let i = index">
          <!-- Nome do hÃ¡bito -->
          <td>
            <div class="habit-name-container">
              <div class="habit-name-display">
                <strong>{{ habit.name }}</strong>
                <span *ngIf="habit.description" class="habit-description">{{ habit.description }}</span>
              </div>

              <button
                class="delete-habit"
                (click)="deleteHabit(i)">
                âœ•
              </button>
            </div>

            <div class="progress-container">
              <div class="progress-bar">
                <div
                  class="progress-fill"
                  [class.goal-reached]="isGoalReached(habit)"
                  [style.width.%]="getHabitProgress(habit)">
                </div>
              </div>
            </div>
          </td>

          <!-- Meta / Progresso -->
          <td>
            <div class="goal-container">
              <div class="goal-label">META</div>
              <div class="goal-value">{{ habit.goal }}</div>
              <div class="current-count">{{ getHabitProgressText(habit) }}</div>
            </div>
          </td>

          <!-- Dias do mÃªs -->
          <td
            *ngFor="let status of habit.statuses; let dayIndex = index"
            class="day-cell"
            [class.done]="status === 'done'"
            [class.not-done]="status === 'not-done'"
            [class.not-needed]="status === 'not-needed'"
            (click)="toggleStatus(habit, dayIndex)">
          </td>
        </tr>

        <tr *ngIf="habits.length === 0">
          <td [attr.colspan]="currentDays + 2" style="text-align: center; padding: 20px;">
            Nenhum hÃ¡bito cadastrado. Clique em "Adicionar HÃ¡bito" para comeÃ§ar!
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal para adicionar hÃ¡bito -->
<div class="modal" *ngIf="showAddHabitModal" (click)="closeAddHabitModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>âž• Adicionar Novo HÃ¡bito</h2>
    <div class="modal-form">
      <label>
        Nome do HÃ¡bito:
        <input
          type="text"
          [(ngModel)]="newHabitName"
          placeholder="Ex: ExercÃ­cios fÃ­sicos"
          (keyup.enter)="confirmAddHabit()">
      </label>
      <label>
        Meta (quantas vezes por mÃªs):
        <input
          type="number"
          [(ngModel)]="newHabitGoal"
          min="1"
          [max]="currentDays"
          value="20"
          placeholder="Ex: 20">
      </label>
      <label>
        DescriÃ§Ã£o (opcional):
        <textarea
          [(ngModel)]="newHabitDescription"
          placeholder="Ex: 30 minutos de caminhada"></textarea>
      </label>
    </div>
    <div class="modal-buttons">
      <button class="modal-btn cancel" (click)="closeAddHabitModal()">Cancelar</button>
      <button class="modal-btn confirm" (click)="confirmAddHabit()">Adicionar</button>
    </div>
  </div>
</div>

<!-- Mensagem de celebraÃ§Ã£o -->
<div class="celebration" *ngIf="showCelebration">
  <h2>ðŸŽ‰ ParabÃ©ns!</h2>
  <p>{{ celebrationMessage }}</p>
</div>
