<div class="vaga-page-content">
  <div class="page-header">
    <h1 class="page-title">Editar Vaga</h1>
    <app-breadcrumb></app-breadcrumb>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <i class="fas fa-spinner fa-spin"></i>Carregando dados da vaga...
  </div>

  <!-- Success Message -->
  <div class="alert alert-success" *ngIf="showSuccessMessage">
    <i class="fas fa-check-circle"></i>
    <span>Vaga atualizada com sucesso! Redirecionando...</span>
  </div>

  <!-- Form Container -->
  <div class="table-container" *ngIf="!isLoading">
    <form [formGroup]="vagaForm" (ngSubmit)="onSubmit()" class="vaga-form">
      <div class="form-layout">
        <div class="left-column">
          <!-- Section: Informações da Empresa -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="fas fa-building"></i>
              Informações da Empresa
            </h3>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Cliente <span class="required">*</span></label>
                <select
                  formControlName="clienteId"
                  class="form-control select-input"
                  [class.error]="isFieldInvalid('clienteId')">
                  <option value="" disabled>Selecione um cliente</option>
                  <option *ngFor="let cliente of clientes" [value]="cliente.id">
                    {{ cliente.nome }}
                  </option>
                </select>
                <span class="error-message" *ngIf="isFieldInvalid('clienteId')">
                  {{ getErrorMessage('clienteId') }}
                </span>
              </div>

              <div class="form-group">
                <label class="form-label">Consultora Responsável <span class="required">*</span></label>
                <select
                  formControlName="usuarioId"
                  class="form-control select-input"
                  [class.error]="isFieldInvalid('usuarioId')">
                  <option value="" disabled>Selecione a consultora</option>
                  <option *ngFor="let usuario of usuarios" [value]="usuario.id">
                    {{ usuario.nome }}
                  </option>
                </select>
                <span class="error-message" *ngIf="isFieldInvalid('usuarioId')">
                  {{ getErrorMessage('usuarioId') }}
                </span>
              </div>
            </div>
          </div>

          <!-- Section: Detalhes da Vaga -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="fas fa-briefcase"></i>
              Detalhes da Vaga
            </h3>

            <div class="form-group">
              <label class="form-label">Cargo <span class="required">*</span></label>
              <input
                type="text"
                formControlName="cargo"
                class="form-control"
                [class.error]="isFieldInvalid('cargo')">
              <span class="error-message" *ngIf="isFieldInvalid('cargo')">
                {{ getErrorMessage('cargo') }}
              </span>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Tipo de Cargo <span class="required">*</span></label>
                <select
                  formControlName="tipoCargo"
                  class="form-control select-input"
                  [class.error]="isFieldInvalid('tipoCargo')">
                  <option value="">Selecione o tipo</option>
                  <option *ngFor="let tipo of tipoCargoOptions" [value]="tipo.value">
                    {{ tipo.label }}
                  </option>
                </select>
                <span class="error-message" *ngIf="isFieldInvalid('tipoCargo')">
                  {{ getErrorMessage('tipoCargo') }}
                </span>
              </div>

              <div class="form-group">
                <label class="form-label">Tipo de Abertura <span class="required">*</span></label>
                <select
                  formControlName="tipoAbertura"
                  class="form-control select-input"
                  [class.error]="isFieldInvalid('tipoAbertura')">
                  <option value="">Selecione o tipo</option>
                  <option *ngFor="let tipo of tipoAberturaOptions" [value]="tipo.value">
                    {{ tipo.label }}
                  </option>
                </select>
                <span class="error-message" *ngIf="isFieldInvalid('tipoAbertura')">
                  {{ getErrorMessage('tipoAbertura') }}
                </span>
              </div>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Salário</label>
                <input
                  type="text"
                  formControlName="salario"
                  appCurrencyMask
                  class="form-control"
                  placeholder="R$ 0,00">
              </div>

              <div class="form-group">
                <label class="form-label">Pretensão Salarial</label>
                <input
                  type="text"
                  formControlName="pretensaoSalarial"
                  appCurrencyMask
                  class="form-control"
                  placeholder="R$ 0,00">
                <small class="form-hint">Expectativa salarial do candidato</small>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Sigilo da Vaga <span class="required">*</span></label>
              <select
                formControlName="sigilosa"
                class="form-control select-input">
                <option [value]="false">Não Sigilosa</option>
                <option [value]="true">Sigilosa</option>
              </select>
            </div>
          </div>

          <!-- Section: Faturamento -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="fas fa-dollar-sign"></i>
              Faturamento
            </h3>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">% de Faturamento</label>
                <input
                  type="number"
                  formControlName="porcentagemFaturamento"
                  class="form-control"
                  placeholder="100"
                  min="0"
                  max="200"
                  step="1">
                <small class="form-hint">Percentual sobre o salário (padrão: 100%)</small>
              </div>

              <div class="form-group">
                <label class="form-label">Imposto do Estado (%)</label>
                <input
                  type="number"
                  formControlName="impostoEstado"
                  class="form-control"
                  placeholder="0"
                  min="0"
                  max="100"
                  step="0.1">
                <small class="form-hint">Percentual do imposto estadual</small>
              </div>
            </div>

          </div>
        </div>

        <div class="right-column">
          <!-- Section: Status e Processo -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="fas fa-tasks"></i>
              Status do Processo
            </h3>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Status <span class="required">*</span></label>
                <select
                  formControlName="status"
                  class="form-control select-input status-select"
                  [class.error]="isFieldInvalid('status')">
                  <option *ngFor="let status of statusOptions" [value]="status.value">
                    {{ status.label }}
                  </option>
                </select>
                <span class="error-message" *ngIf="isFieldInvalid('status')">
                  {{ getErrorMessage('status') }}
                </span>
              </div>

              <div class="form-group">
                <label class="form-label">Data de Abertura <span class="required">*</span></label>
                <input
                  type="date"
                  formControlName="dataAbertura"
                  class="form-control date-input"
                  [class.error]="isFieldInvalid('dataAbertura')">
                <span class="error-message" *ngIf="isFieldInvalid('dataAbertura')">
                  {{ getErrorMessage('dataAbertura') }}
                </span>
              </div>
            </div>

            <div class="form-group" *ngIf="['fechada', 'fechada_rep', 'cancelada_cliente'].includes(vagaForm.get('status')?.value)">
              <label class="form-label">Data de Fechamento/Cancelamento</label>
              <input
                type="date"
                formControlName="dataFechamentoCancelamento"
                class="form-control date-input">
            </div>

            <div class="form-group">
              <label class="form-label">Fonte de Recrutamento <span class="required">*</span></label>
              <select
                formControlName="fonteRecrutamento"
                class="form-control select-input"
                [class.error]="isFieldInvalid('fonteRecrutamento')">
                <option value="">Selecione a fonte</option>
                <option *ngFor="let fonte of fonteRecrutamentoOptions" [value]="fonte.value">
                  {{ fonte.label }}
                </option>
              </select>
              <span class="error-message" *ngIf="isFieldInvalid('fonteRecrutamento')">
                {{ getErrorMessage('fonteRecrutamento') }}
              </span>
            </div>

          </div>

          <!-- Section: Observações -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="fas fa-file-alt"></i>
              Observações
            </h3>

            <div class="form-group">
              <label class="form-label">Observações</label>
              <textarea
                formControlName="observacoes"
                class="form-control"
                rows="5"
                placeholder="Informações adicionais sobre a vaga..."></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancel()"
          [disabled]="isSubmitting">
          <i class="fas fa-arrow-left"></i>
          Voltar
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="isSubmitting || vagaForm.invalid">
          <i class="fas" [ngClass]="isSubmitting ? 'fa-spinner fa-spin' : 'fa-save'"></i>
          {{ isSubmitting ? 'Salvando...' : 'Atualizar Vaga' }}
        </button>
      </div>
    </form>
  </div>
</div>
