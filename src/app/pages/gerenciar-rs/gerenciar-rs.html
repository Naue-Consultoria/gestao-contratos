<div class="page-header">
  <h1 class="page-title">Gerenciar Vagas R&S</h1>
  <app-breadcrumb></app-breadcrumb>
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Carregando clientes...</p>
</div>

<!-- Main Content -->
<div class="content" *ngIf="!isLoading">
  <!-- Cliente Selector -->
  <div class="selector-section">
    <div class="selector-card">
      <label for="clienteSelect" class="selector-label">
        <i class="fas fa-building"></i>
        Selecione o Cliente
      </label>
      <div class="selector-group">
        <select
          id="clienteSelect"
          [(ngModel)]="clienteSelecionadoId"
          (ngModelChange)="onClienteChange()"
          class="form-select">
          <option [ngValue]="null">-- Escolha um cliente --</option>
          <option *ngFor="let cliente of clientes" [ngValue]="cliente.client.id">
            {{ getClienteName(cliente.client) }}
          </option>
        </select>
        <button
          class="btn-hub"
          *ngIf="clienteSelecionado"
          (click)="openLinkModal()"
          [disabled]="!clienteSelecionado">
          <i class="fas fa-share-alt"></i>
          {{ hasHubToken(clienteSelecionado.client) ? 'Ver Link do Hub' : 'Gerar Link do Hub' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Cliente Info & Vagas -->
  <div *ngIf="clienteSelecionado" class="cliente-info-section">
    <!-- Cliente Header -->
    <div class="cliente-header-info">
      <div class="cliente-details">
        <h2>
          <i class="fas fa-building"></i>
          {{ getClienteName(clienteSelecionado.client) }}
        </h2>
        <p class="cliente-email">{{ clienteSelecionado.client.email }}</p>
      </div>
      <div class="hub-status-badge" *ngIf="hasHubToken(clienteSelecionado.client)">
        <i class="fas fa-link"></i>
        <span>Hub Público Ativo</span>
      </div>
    </div>

    <!-- Loading Vagas -->
    <div *ngIf="isLoadingVagas" class="loading-vagas">
      <div class="loading-spinner-small"></div>
      <span>Carregando vagas...</span>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingVagas && clienteSelecionado.vagas.length === 0" class="empty-state">
      <i class="fas fa-briefcase"></i>
      <p>Este cliente não possui vagas cadastradas</p>
    </div>

    <!-- Vagas Table -->
    <div *ngIf="!isLoadingVagas && clienteSelecionado.vagas.length > 0" class="vagas-section">
      <div class="section-header">
        <h3><i class="fas fa-list"></i> Vagas ({{ clienteSelecionado.vagas.length }})</h3>
      </div>

      <div class="vagas-table">
        <table>
          <thead>
            <tr>
              <th>Código</th>
              <th>Cargo</th>
              <th>Tipo</th>
              <th>Status</th>
              <th>Data Abertura</th>
              <th class="text-center">Candidatos</th>
              <th class="text-center">Visível no Hub</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let vaga of clienteSelecionado.vagas">
              <td><strong>{{ vaga.codigo }}</strong></td>
              <td class="cargo-cell">{{ vaga.cargo }}</td>
              <td>
                <span class="badge badge-tipo">{{ getTipoCargoLabel(vaga.tipo_cargo) }}</span>
              </td>
              <td>
                <span class="badge badge-status" [attr.data-status]="vaga.status">
                  {{ getStatusLabel(vaga.status) }}
                </span>
              </td>
              <td>{{ formatDate(vaga.data_abertura) }}</td>
              <td class="text-center">{{ vaga.total_candidatos || 0 }}</td>
              <td class="text-center">
                <label class="toggle-switch" [title]="vaga.is_visible_in_hub ? 'Ocultar do hub' : 'Mostrar no hub'">
                  <input type="checkbox"
                         [checked]="vaga.is_visible_in_hub"
                         (change)="toggleVisibilidade(vaga)">
                  <span class="toggle-slider"></span>
                </label>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Link Modal -->
<div class="modal-overlay" *ngIf="showLinkModal" (click)="closeLinkModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i class="fas fa-share-alt"></i>
        Hub de Vagas - {{ selectedClient ? getClienteName(selectedClient.client) : '' }}
      </h3>
      <button class="close-btn" (click)="closeLinkModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <p class="modal-description">
        Gere um link público para que este cliente possa visualizar todas as suas vagas em um só lugar.
        Apenas as vagas marcadas como "visíveis" aparecerão no hub.
      </p>

      <div class="form-group" *ngIf="!publicLink">
        <label for="linkExpiration">Expiração do Link (opcional)</label>
        <select id="linkExpiration" [(ngModel)]="linkExpiration" class="form-control">
          <option [value]="0">Sem expiração</option>
          <option [value]="7">7 dias</option>
          <option [value]="15">15 dias</option>
          <option [value]="30">30 dias</option>
          <option [value]="60">60 dias</option>
          <option [value]="90">90 dias</option>
        </select>
        <small class="form-text">
          Escolha quando o link deve expirar. Após a expiração, será necessário gerar um novo link.
        </small>
      </div>

      <div class="link-display" *ngIf="publicLink">
        <div class="link-container">
          <input type="text"
                 [value]="publicLink"
                 readonly
                 class="link-input"
                 id="publicLinkInput">
          <button class="btn-copy" (click)="copiarLink()" title="Copiar Link">
            <i class="fas fa-copy"></i>
          </button>
        </div>
        <p class="link-info">
          <i class="fas fa-info-circle"></i>
          Link gerado com sucesso! Compartilhe este link para dar acesso ao hub de vagas.
        </p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeLinkModal()">
        Fechar
      </button>
      <button class="btn btn-danger"
              *ngIf="publicLink"
              (click)="removerLinkHub()">
        <i class="fas fa-trash"></i>
        Remover Acesso
      </button>
      <button class="btn btn-primary"
              *ngIf="!publicLink"
              (click)="gerarLinkHub()">
        <i class="fas fa-link"></i>
        Gerar Link
      </button>
    </div>
  </div>
</div>
