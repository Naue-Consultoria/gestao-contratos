<div class="mentoria-publica-page">

  <!-- LOADING -->
  <div *ngIf="isLoading" class="loading-screen">
    <div class="loading-spinner"></div>
    <p>Carregando mentoria...</p>
  </div>

  <!-- ERROR STATES -->
  <div *ngIf="notFound && !isLoading" class="error-screen">
    <div class="error-container">
      <i class="fa-solid fa-circle-exclamation"></i>
      <h1>Mentoria não encontrada</h1>
      <p>O link que você está tentando acessar não existe ou foi removido.</p>
    </div>
  </div>

  <div *ngIf="expired && !isLoading && !notFound" class="error-screen">
    <div class="error-container">
      <i class="fa-solid fa-clock"></i>
      <h1>Link expirado</h1>
      <p>Este link de acesso expirou. Entre em contato com seu mentor para obter um novo link.</p>
    </div>
  </div>

  <!-- CONTEÚDO PRINCIPAL -->
  <div *ngIf="encontro && !isLoading && !notFound && !expired" class="mentoria-content">

    <!-- Dropdown de Navegação entre Encontros (quando há 2+ encontros publicados) -->
    <div class="encontros-nav-dropdown" *ngIf="shouldShowDropdown()">
      <button
        class="encontros-nav-toggle"
        (click)="toggleEncontrosDropdown()"
        [class.active]="showEncontrosDropdown">
        <i class="fas fa-list"></i>
        <span class="nav-text">Encontro {{ encontro.numero_encontro }}</span>
        <i class="fas fa-chevron-down nav-arrow" [class.rotated]="showEncontrosDropdown"></i>
      </button>

      <div class="encontros-nav-menu" *ngIf="showEncontrosDropdown">
        <div class="nav-menu-header">
          <span>Todos os Encontros</span>
        </div>
        <button
          *ngFor="let outro of getEncontrosPublicados()"
          class="encontro-nav-item"
          [class.current]="outro.is_current"
          (click)="navegarParaEncontro(outro.unique_token)"
          [disabled]="outro.is_current">
          <div class="encontro-nav-numero">#{{ outro.numero_encontro }}</div>
          <div class="encontro-nav-info">
            <span class="encontro-nav-nome">{{ outro.mentorado_nome }}</span>
            <span class="encontro-nav-status" *ngIf="outro.is_current">
              <i class="fas fa-circle"></i> Você está aqui
            </span>
          </div>
          <i class="fas fa-chevron-right" *ngIf="!outro.is_current"></i>
        </button>
      </div>
    </div>

    <!-- Botão Voltar ao Hub (quando há apenas 1 encontro publicado) -->
    <div class="encontros-nav-dropdown" *ngIf="shouldShowBackButton()">
      <button
        class="encontros-nav-toggle"
        (click)="voltarParaHub()">
        <i class="fas fa-arrow-left"></i>
        <span class="nav-text">Voltar ao Hub da Mentoria</span>
      </button>
    </div>

    <!-- Header Hero -->
    <header class="mentoria-hero" [class.has-photo]="encontro.foto_encontro_url">
      <div class="hero-overlay"></div>
      <div class="hero-container">
        <div class="hero-brand">
          <img src="logoNaueNeg.png" alt="NAUE Consultoria" class="hero-logo">
        </div>

        <!-- Layout com foto: side-by-side -->
        <div class="hero-content-wrapper" *ngIf="encontro.foto_encontro_url">
          <div class="hero-text-side">
            <div class="welcome-message">
              <div class="welcome-line-1">
                <span class="welcome-word">Olá,</span>
                <span class="welcome-name">{{ encontro.mentorado_nome }}!</span>
              </div>
              <div class="welcome-line-2">
                <span class="welcome-word">Bem-vindo(a)</span>
                <span class="welcome-word">ao</span>
                <span class="welcome-word">seu</span>
                <span class="welcome-word">PD | Plano Diretivo!</span>
              </div>
            </div>

            <div class="hero-info">
              <div class="meta-info">
                <span class="meta-item">
                  <i class="fa-solid fa-hashtag"></i>
                  Encontro {{ encontro.numero_encontro }}
                </span>
                <span class="meta-item">
                  <i class="fa-solid fa-calendar"></i>
                  {{ formatDate(encontro.data_encontro) }}
                </span>
              </div>
            </div>
          </div>

          <div class="hero-photo-side">
            <img [src]="encontro.foto_encontro_url" [alt]="'Foto do Encontro ' + encontro.numero_encontro" class="encontro-photo">
          </div>
        </div>

        <!-- Layout sem foto: centralizado (layout original) -->
        <ng-container *ngIf="!encontro.foto_encontro_url">
          <div class="welcome-message">
            <div class="welcome-line-1">
              <span class="welcome-word">Olá,</span>
              <span class="welcome-name">{{ encontro.mentorado_nome }}!</span>
            </div>
            <div class="welcome-line-2">
              <span class="welcome-word">Bem-vindo(a)</span>
              <span class="welcome-word">ao</span>
              <span class="welcome-word">seu</span>
              <span class="welcome-word">PD | Plano Diretivo!</span>
            </div>
          </div>

          <div class="hero-info">
            <div class="meta-info">
              <span class="meta-item">
                <i class="fa-solid fa-hashtag"></i>
                Encontro {{ encontro.numero_encontro }}
              </span>
              <span class="meta-item">
                <i class="fa-solid fa-calendar"></i>
                {{ formatDate(encontro.data_encontro) }}
              </span>
            </div>
          </div>
        </ng-container>
      </div>
    </header>

    <!-- Botão de Exportação Completa -->
    <div class="exportacao-completa-section" *ngIf="conteudoEstruturado">
      <div class="exportacao-completa-container">
        <button
          class="btn-exportacao-completa"
          (click)="exportarTodasFerramentasPDF()">
          <i class="fa-solid fa-file-pdf"></i>
          <span>Exportar Todas as Ferramentas em PDF</span>
        </button>
        <p class="exportacao-hint">
          <i class="fa-solid fa-info-circle"></i>
          Clique para baixar um PDF com todas as ferramentas deste encontro em um único arquivo
        </p>
      </div>
    </div>

    <!-- Seção de Visão Geral e Mentoria -->
    <section class="intro-section" *ngIf="conteudoEstruturado">
      <div class="intro-container"
           [class.single-block]="(conteudoEstruturado.visaoGeral?.ativo && conteudoEstruturado.visaoGeral?.conteudo && !(conteudoEstruturado.mentoria?.ativo && conteudoEstruturado.mentoria?.conteudo)) ||
                                  (!(conteudoEstruturado.visaoGeral?.ativo && conteudoEstruturado.visaoGeral?.conteudo) && conteudoEstruturado.mentoria?.ativo && conteudoEstruturado.mentoria?.conteudo)">
        <!-- Visão Geral -->
        <div *ngIf="conteudoEstruturado.visaoGeral?.ativo && conteudoEstruturado.visaoGeral?.conteudo"
             class="intro-block visao-geral-block">
          <div class="intro-header">
            <div class="intro-icon">
              <i class="fa-solid fa-bullseye"></i>
            </div>
            <h2>Visão Geral</h2>
          </div>
          <div class="intro-content">
            <p>{{ conteudoEstruturado.visaoGeral.conteudo }}</p>
          </div>
        </div>

        <!-- Mentoria -->
        <div *ngIf="conteudoEstruturado.mentoria?.ativo && conteudoEstruturado.mentoria?.conteudo"
             class="intro-block mentoria-block">
          <div class="intro-header">
            <div class="intro-icon">
              <i class="fa-solid fa-graduation-cap"></i>
            </div>
            <h2>Conteúdo da Mentoria</h2>
          </div>
          <div class="intro-content">
            <p>{{ conteudoEstruturado.mentoria.conteudo }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- SEÇÕES REORDENÁVEIS -->
    <ng-container *ngFor="let secaoId of secoesOrdenadas">

    <!-- Testes Section -->
    <section *ngIf="secaoId === 'testes'" class="dark-section testes-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.testes?.ativo || !conteudoEstruturado.testes?.itens?.length">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-clipboard-check"></i>
            Testes Realizados
          </h2>
        </div>
        <div class="testes-grid-new">
          <article *ngFor="let teste of conteudoEstruturado.testes.itens" class="teste-card">
            <h3>{{ teste.nome }}</h3>
            <div *ngIf="teste.imagemUrl && !teste.isPdf" class="teste-img-new">
              <img [src]="teste.imagemUrl" [alt]="teste.nome">
            </div>
            <div *ngIf="teste.isPdf && teste.imagemUrl" class="teste-pdf-new">
              <div class="pdf-icon-wrapper">
                <i class="fas fa-file-pdf"></i>
              </div>
              <div class="pdf-info">
                <span class="pdf-label">Arquivo PDF</span>
                <a [href]="teste.imagemUrl" target="_blank" class="btn-download-pdf">
                  <i class="fas fa-download"></i>
                  Baixar / Visualizar PDF
                </a>
              </div>
            </div>
            <p *ngIf="teste.comentario" class="teste-comentario">{{ teste.comentario }}</p>
          </article>
        </div>
      </div>
    </section>

    <!-- Próximos Passos Section -->
    <section *ngIf="secaoId === 'proximosPassos'" class="dark-section proximos-passos-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.proximosPassos?.ativo || !conteudoEstruturado.proximosPassos?.blocos?.length">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-arrow-right"></i>
            Próximos Passos
          </h2>
        </div>
        <div class="passos-container">
          <div *ngFor="let bloco of conteudoEstruturado.proximosPassos.blocos" class="passo-card">

              <!-- Texto -->
              <div *ngIf="bloco.tipo === 'texto'" class="passo-texto-block">
                <div class="texto-indicator"></div>
                <div class="texto-content" [innerHTML]="bloco.conteudo"></div>
              </div>

              <!-- Perguntas -->
              <div *ngIf="bloco.tipo === 'perguntas' && bloco.perguntas?.length > 0" class="passo-perguntas-block">
                <div class="block-title">
                  <i class="fa-solid fa-question-circle"></i>
                  <span>{{ getNomeTemplate(bloco) }}</span>
                </div>
                <div class="perguntas-container">
                  <div *ngFor="let pergunta of bloco.perguntas; let i = index" class="pergunta-item">
                    <div class="pergunta-num">{{ i + 1 }}</div>
                    <div class="pergunta-body">
                      <p class="pergunta-q" style="white-space: pre-wrap;">{{ pergunta.pergunta }}</p>
                      <textarea
                        class="pergunta-input"
                        [(ngModel)]="pergunta.respostaUsuario"
                        (blur)="salvarRespostaAutomaticamente(bloco, i)"
                        placeholder="Digite sua resposta aqui..."
                        rows="4"></textarea>
                    </div>
                  </div>
                </div>
                <div class="perguntas-actions">
                  <button
                    type="button"
                    class="btn-save-respostas"
                    (click)="salvarRespostas(bloco)"
                    [disabled]="savingInteractions">
                    <i class="fa-solid" [ngClass]="savingInteractions ? 'fa-circle-notch fa-spin' : 'fa-save'"></i>
                    {{ savingInteractions ? 'Salvando...' : 'Salvar Respostas' }}
                  </button>
                </div>
              </div>

              <!-- Tarefas -->
              <div *ngIf="bloco.tipo === 'tarefas' && bloco.tarefas?.itens?.length > 0" class="passo-tarefas-block">
                <div class="block-title">
                  <i class="fa-solid fa-list-check"></i>
                  <span>{{ bloco.tarefas.titulo || 'Tarefas' }}</span>
                </div>
                <ul class="tarefas-container">
                  <li *ngFor="let tarefa of bloco.tarefas.itens; let j = index">
                    <label class="tarefa-checkbox">
                      <input
                        type="checkbox"
                        [(ngModel)]="tarefa.checked"
                        (change)="salvarEstadoTarefa(bloco, j)">
                      <span class="checkbox-custom"></span>
                      <span class="tarefa-text">{{ tarefa.texto || tarefa }}</span>
                    </label>
                  </li>
                </ul>
              </div>

          </div>
        </div>

        <!-- Botões de Ação -->
        <div class="section-actions">
          <button
            type="button"
            class="btn-section-export"
            (click)="exportarProximosPassosPDF()">
            <i class="fa-solid fa-file-pdf"></i>
            Exportar PDF
          </button>
        </div>
      </div>
    </section>

    <!-- Referências Section -->
    <section *ngIf="secaoId === 'referencias'" class="dark-section referencias-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.referencias?.ativo || !conteudoEstruturado.referencias?.itens?.length">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-book"></i>
            Referências e Inspirações
          </h2>
        </div>
        <div class="referencias-grid">
          <ng-container *ngFor="let ref of conteudoEstruturado.referencias.itens; let refIndex = index">
            <div class="ref-card-container">
              <!-- Vídeo do YouTube incorporado -->
              <div *ngIf="ref.link && isYouTubeUrl(ref.link)" class="youtube-video-container">
                <div class="ref-header">
                  <div class="ref-icon-new">
                    <i class="fa-solid fa-play-circle"></i>
                  </div>
                  <div class="ref-content-new">
                    <span class="ref-type">{{ getReferenciaLabel(ref.tipo) }}</span>
                    <h4>{{ ref.titulo }}</h4>
                  </div>
                  <a [href]="ref.link" target="_blank" class="ref-external-link" title="Abrir no YouTube">
                    <i class="fa-solid fa-external-link-alt"></i>
                  </a>
                </div>
                <div class="video-embed">
                  <iframe
                    [src]="getYouTubeEmbedUrl(ref.link)"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
                  </iframe>
                </div>
              </div>

              <!-- Com link (não YouTube): elemento clicável -->
              <a *ngIf="ref.link && ref.link.trim() !== '' && !isYouTubeUrl(ref.link)"
                 [href]="ref.link"
                 target="_blank"
                 class="ref-card">
                <div class="ref-icon-new">
                  <i class="fa-solid"
                     [ngClass]="{
                       'fa-play-circle': ref.tipo === 'ted',
                       'fa-book': ref.tipo === 'livro',
                       'fa-newspaper': ref.tipo === 'leitura',
                       'fa-video': ref.tipo === 'video',
                       'fa-link': ref.tipo === 'link',
                       'fa-clipboard-check': ref.tipo === 'teste',
                       'fa-dumbbell': ref.tipo === 'gymrats',
                       'fa-circle-info': ref.tipo === 'outro'
                     }"></i>
                </div>
                <div class="ref-content-new">
                  <span class="ref-type">{{ getReferenciaLabel(ref.tipo) }}</span>
                  <h4>{{ ref.titulo }}</h4>
                </div>
                <i class="fa-solid fa-external-link-alt ref-external-new"></i>
              </a>

              <!-- Sem link: elemento não clicável -->
              <div *ngIf="!ref.link || ref.link.trim() === ''"
                   class="ref-card ref-card-no-link">
                <div class="ref-icon-new">
                  <i class="fa-solid"
                     [ngClass]="{
                       'fa-play-circle': ref.tipo === 'ted',
                       'fa-book': ref.tipo === 'livro',
                       'fa-newspaper': ref.tipo === 'leitura',
                       'fa-video': ref.tipo === 'video',
                       'fa-link': ref.tipo === 'link',
                       'fa-clipboard-check': ref.tipo === 'teste',
                       'fa-dumbbell': ref.tipo === 'gymrats',
                       'fa-circle-info': ref.tipo === 'outro'
                     }"></i>
                </div>
                <div class="ref-content-new">
                  <span class="ref-type">{{ getReferenciaLabel(ref.tipo) }}</span>
                  <h4>{{ ref.titulo }}</h4>
                </div>
              </div>

              <!-- Campo de Anotações do Mentorado -->
              <div class="ref-anotacoes">
                <label class="anotacoes-label">
                  <i class="fa-solid fa-pen"></i>
                  Seus Aprendizados:
                </label>
                <textarea
                  class="anotacoes-textarea"
                  [(ngModel)]="ref.anotacaoMentorado"
                  placeholder="Anote aqui seus principais aprendizados desta referência..."
                  rows="3"></textarea>
              </div>
            </div>
          </ng-container>
        </div>

        <!-- Botão para salvar todas as anotações -->
        <div class="referencias-actions">
          <button
            type="button"
            class="btn-save-anotacoes"
            (click)="salvarTodasAnotacoesReferencias()"
            [disabled]="salvandoAnotacoes">
            <i class="fa-solid" [ngClass]="salvandoAnotacoes ? 'fa-circle-notch fa-spin' : 'fa-save'"></i>
            {{ salvandoAnotacoes ? 'Salvando...' : 'Salvar Aprendizados' }}
          </button>
        </div>
      </div>
    </section>

    <!-- Modelo ABC Section -->
    <section *ngIf="secaoId === 'modeloABC'" class="dark-section modelo-abc-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.modeloABC?.ativo">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-brain"></i>
            Modelo ABC
          </h2>
          <p class="dark-subtitle">Adversity, Belief, Consequence</p>
        </div>

        <div class="modelo-abc-content">

          <!-- Cabeçalho ABC -->
          <div class="abc-header-grid-public">
            <div class="abc-header-card abc-a">
              <div class="abc-letter-large">A</div>
              <h3 class="abc-card-title">Adversity</h3>
              <p class="abc-card-desc">Adversidade: acontecimento que funciona como "gatilho" para o pensamento/crença irracional</p>
            </div>
            <div class="abc-header-card abc-b">
              <div class="abc-letter-large">B</div>
              <h3 class="abc-card-title">Belief</h3>
              <p class="abc-card-desc">Pensamento: "X" TEM que/ NÃO TEM que (exigência) + "ação" + SENÃO "X" É (rótulo)</p>
            </div>
            <div class="abc-header-card abc-c">
              <div class="abc-letter-large">C</div>
              <h3 class="abc-card-title">Consequence</h3>
              <p class="abc-card-desc">Consequência: emoção, reações fisiológicas e ação/comportamento</p>
            </div>
          </div>

          <!-- Campos ABC -->
          <div class="abc-inputs-grid">
            <div class="abc-input-group">
              <textarea
                class="abc-input"
                [(ngModel)]="modeloABC.adversidade"
                placeholder="Descreva a adversidade..."
                rows="6"></textarea>
            </div>
            <div class="abc-input-group">
              <textarea
                class="abc-input"
                [(ngModel)]="modeloABC.pensamento"
                placeholder="Descreva o pensamento/crença..."
                rows="6"></textarea>
            </div>
            <div class="abc-input-group">
              <textarea
                class="abc-input"
                [(ngModel)]="modeloABC.consequencia"
                placeholder="Descreva as consequências..."
                rows="6"></textarea>
            </div>
          </div>

          <!-- Verificação -->
          <div class="abc-verification-box">
            <h4>Verificação se o pensamento é lógico, realista e produtivo</h4>
          </div>

          <!-- Antídotos -->
          <div class="abc-antidotos-section">
            <div class="abc-field">
              <label>Antídoto para exigência:</label>
              <textarea
                class="abc-input"
                [(ngModel)]="modeloABC.antidotoExigencia"
                placeholder="Escreva o antídoto para a exigência..."
                rows="3"></textarea>
            </div>

            <div class="abc-field">
              <label>Antídoto para o rótulo:</label>
              <textarea
                class="abc-input"
                [(ngModel)]="modeloABC.antidotoRotulo"
                placeholder="Escreva o antídoto para o rótulo..."
                rows="3"></textarea>
            </div>

            <div class="abc-field">
              <label>Frase de nocaute:</label>
              <textarea
                class="abc-input"
                [(ngModel)]="modeloABC.fraseNocaute"
                placeholder="Escreva a frase de nocaute..."
                rows="2"></textarea>
            </div>
          </div>

          <!-- Tarefa 1 -->
          <div class="abc-task-info">
            <i class="fa-solid fa-clipboard-list"></i>
            <p><strong>Tarefa:</strong> Ler as frases antídotos 4 vezes por dia por 30 dias, e antes de momentos críticos.</p>
          </div>

          <!-- Plano de Ação -->
          <div class="abc-field">
            <label>Plano de ação para lidar com o tipo de acontecimento que ativa a crença:</label>
            <textarea
              class="abc-input"
              [(ngModel)]="modeloABC.planoAcao"
              placeholder="Descreva o plano de ação..."
              rows="4"></textarea>
          </div>

          <!-- Nível de Disposição -->
          <div class="abc-field">
            <label>De 0 a 10 o quanto você está disposta(o) a colocar este plano em ação?</label>
            <div class="abc-slider-container">
              <input
                type="range"
                min="0"
                max="10"
                [(ngModel)]="modeloABC.nivelDisposicao"
                class="abc-slider">
              <span class="abc-slider-value">{{ modeloABC.nivelDisposicao }}</span>
            </div>
          </div>

          <!-- Impedimentos -->
          <div class="abc-field">
            <label>O que poderia impedir de colocá-lo em ação?</label>
            <textarea
              class="abc-input"
              [(ngModel)]="modeloABC.impedimentos"
              placeholder="Liste os possíveis impedimentos..."
              rows="3"></textarea>
          </div>

          <div class="abc-field">
            <label>O que fará caso os impedimentos apareçam?</label>
            <textarea
              class="abc-input"
              [(ngModel)]="modeloABC.acaoImpedimentos"
              placeholder="Descreva as ações..."
              rows="3"></textarea>
          </div>

          <!-- Tarefa 2 -->
          <div class="abc-task-info">
            <i class="fa-solid fa-clipboard-list"></i>
            <p><strong>Tarefa:</strong> Executar o plano de ação por uma semana e anotar como foi a execução deste plano.</p>
          </div>

          <!-- Botão Salvar -->
          <div class="abc-actions">
            <button
              type="button"
              class="btn-save-abc"
              (click)="salvarModeloABC()"
              [disabled]="salvandoModeloABC">
              <i class="fa-solid" [ngClass]="salvandoModeloABC ? 'fa-spinner fa-spin' : 'fa-save'"></i>
              {{ salvandoModeloABC ? 'Salvando...' : 'Salvar Modelo ABC' }}
            </button>
          </div>

        </div>
      </div>
    </section>

    <!-- Zonas de Aprendizado Section -->
    <section *ngIf="secaoId === 'zonasAprendizado'" class="dark-section zonas-aprendizado-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.zonasAprendizado?.ativo">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-chart-simple"></i>
            Zonas de Aprendizado
          </h2>
          <p class="dark-subtitle">Segurança Psicológica x Motivação e Senso de Dono(a)</p>
        </div>

        <div class="zonas-aprendizado-content">

          <!-- Controles -->
          <div class="zonas-controls">
            <div class="add-palavra-container">
              <input
                type="text"
                class="input-palavra"
                [(ngModel)]="novaPalavra"
                (keyup.enter)="adicionarPalavraZona()"
                placeholder="Digite uma palavra/conceito e pressione Enter...">
              <button
                type="button"
                class="btn-add-palavra"
                (click)="adicionarPalavraZona()">
                <i class="fa-solid fa-plus"></i>
                Adicionar
              </button>
            </div>

            <div class="zonas-actions-container">
              <button
                type="button"
                class="btn-salvar-zonas"
                (click)="salvarZonasAprendizado()"
                [disabled]="salvandoZonas">
                <i class="fa-solid" [ngClass]="salvandoZonas ? 'fa-spinner fa-spin' : 'fa-save'"></i>
                {{ salvandoZonas ? 'Salvando...' : 'Salvar Gráfico' }}
              </button>

              <button
                type="button"
                class="btn-export-zonas"
                (click)="exportarZonasAprendizadoPDF()">
                <i class="fa-solid fa-file-pdf"></i>
                Exportar PDF
              </button>
            </div>
          </div>

          <!-- Gráfico de 4 Quadrantes -->
          <div class="zonas-quadrantes-container">

          <!-- Grid de Quadrantes -->
          <div class="quadrantes-grid">

            <!-- Eixo Y (vertical) - na borda esquerda -->
            <div class="eixo-y">
              <div class="eixo-label">Motivação e Senso de Dono(a)</div>
            </div>

            <!-- Eixo X (horizontal) - na borda inferior -->
            <div class="eixo-x">
              <div class="eixo-label">Segurança Psicológica</div>
            </div>

            <!-- Quadrante: Zona de Ansiedade (superior esquerdo) -->
            <div class="quadrante zona-ansiedade"
                 (drop)="onDropPalavra($event, 'ansiedade')"
                 (dragover)="onDragOver($event)"
                 (dragleave)="onDragLeave($event)">
              <div class="quadrante-header">
                <h3>Zona de Ansiedade</h3>
              </div>
              <div class="quadrante-content">
                <div
                  *ngFor="let palavra of getPalavrasPorZona('ansiedade')"
                  class="palavra-tag"
                  draggable="true"
                  (dragstart)="onDragStart($event, palavra.id)">
                  <span>{{ palavra.texto }}</span>
                  <button
                    class="btn-remove-palavra"
                    (click)="removerPalavraZona(palavra.id)">
                    <i class="fa-solid fa-times"></i>
                  </button>
                </div>
                <p *ngIf="getPalavrasPorZona('ansiedade').length === 0" class="zona-empty">
                  Arraste palavras aqui
                </p>
              </div>
            </div>

            <!-- Quadrante: Zona de Aprendizado (superior direito) -->
            <div class="quadrante zona-aprendizado"
                 (drop)="onDropPalavra($event, 'aprendizado')"
                 (dragover)="onDragOver($event)"
                 (dragleave)="onDragLeave($event)">
              <div class="quadrante-header">
                <h3>Zona de Aprendizado</h3>
              </div>
              <div class="quadrante-content">
                <div
                  *ngFor="let palavra of getPalavrasPorZona('aprendizado')"
                  class="palavra-tag"
                  draggable="true"
                  (dragstart)="onDragStart($event, palavra.id)">
                  <span>{{ palavra.texto }}</span>
                  <button
                    class="btn-remove-palavra"
                    (click)="removerPalavraZona(palavra.id)">
                    <i class="fa-solid fa-times"></i>
                  </button>
                </div>
                <p *ngIf="getPalavrasPorZona('aprendizado').length === 0" class="zona-empty">
                  Arraste palavras aqui
                </p>
              </div>
            </div>

            <!-- Quadrante: Zona de Apatia (inferior esquerdo) -->
            <div class="quadrante zona-apatia"
                 (drop)="onDropPalavra($event, 'apatia')"
                 (dragover)="onDragOver($event)"
                 (dragleave)="onDragLeave($event)">
              <div class="quadrante-header">
                <h3>Zona de Apatia</h3>
              </div>
              <div class="quadrante-content">
                <div
                  *ngFor="let palavra of getPalavrasPorZona('apatia')"
                  class="palavra-tag"
                  draggable="true"
                  (dragstart)="onDragStart($event, palavra.id)">
                  <span>{{ palavra.texto }}</span>
                  <button
                    class="btn-remove-palavra"
                    (click)="removerPalavraZona(palavra.id)">
                    <i class="fa-solid fa-times"></i>
                  </button>
                </div>
                <p *ngIf="getPalavrasPorZona('apatia').length === 0" class="zona-empty">
                  Arraste palavras aqui
                </p>
              </div>
            </div>

            <!-- Quadrante: Zona de Conforto (inferior direito) -->
            <div class="quadrante zona-conforto"
                 (drop)="onDropPalavra($event, 'conforto')"
                 (dragover)="onDragOver($event)"
                 (dragleave)="onDragLeave($event)">
              <div class="quadrante-header">
                <h3>Zona de Conforto</h3>
              </div>
              <div class="quadrante-content">
                <div
                  *ngFor="let palavra of getPalavrasPorZona('conforto')"
                  class="palavra-tag"
                  draggable="true"
                  (dragstart)="onDragStart($event, palavra.id)">
                  <span>{{ palavra.texto }}</span>
                  <button
                    class="btn-remove-palavra"
                    (click)="removerPalavraZona(palavra.id)">
                    <i class="fa-solid fa-times"></i>
                  </button>
                </div>
                <p *ngIf="getPalavrasPorZona('conforto').length === 0" class="zona-empty">
                  Arraste palavras aqui
                </p>
              </div>
            </div>

          </div>

        </div>

          <!-- Legenda -->
          <div class="zonas-legenda">
            <p class="legenda-fonte">Fonte: The Fearless Organization Flow</p>
          </div>

        </div>
      </div>
    </section>

    <!-- The Golden Circle Section -->
    <section *ngIf="secaoId === 'goldenCircle'" class="dark-section golden-circle-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.goldenCircle?.ativo">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-bullseye"></i>
            The Golden Circle
          </h2>
          <p class="dark-subtitle">Descubra seu propósito, processo e resultado</p>
        </div>

        <div class="golden-circle-content">

          <!-- Layout: Círculos + Perguntas -->
          <div class="golden-circle-layout">

            <!-- Círculos SVG com Setas -->
            <div class="golden-circles-svg">
              <svg viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
                <!-- Círculo externo (WHAT) -->
                <circle cx="250" cy="350" r="200" fill="none" stroke="#022c22" stroke-width="3"/>
                <text x="250" y="530" text-anchor="middle" font-size="32" font-weight="bold" fill="#022c22">WHAT</text>

                <!-- Círculo médio (HOW) -->
                <circle cx="250" cy="350" r="133" fill="none" stroke="#022c22" stroke-width="3"/>
                <text x="250" y="470" text-anchor="middle" font-size="32" font-weight="bold" fill="#022c22">HOW</text>

                <!-- Círculo interno (WHY) -->
                <circle cx="250" cy="350" r="66" fill="none" stroke="#022c22" stroke-width="3"/>
                <text x="250" y="365" text-anchor="middle" font-size="32" font-weight="bold" fill="#022c22">WHY</text>

                <!-- Seta para WHY (do círculo interno para cima-direita) -->
                <path d="M 316 340 Q 450 80 650 80" stroke="#022c22" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

                <!-- Seta para HOW (horizontal do círculo médio) -->
                <line x1="383" y1="350" x2="650" y2="350" stroke="#022c22" stroke-width="3" marker-end="url(#arrowhead)"/>

                <!-- Seta para WHAT (do círculo externo para baixo-direita) -->
                <path d="M 391 491 Q 500 620 650 620" stroke="#022c22" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

                <!-- Definição da ponta de seta -->
                <defs>
                  <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#022c22"/>
                  </marker>
                </defs>
              </svg>
            </div>

            <!-- Campos de Perguntas -->
            <div class="golden-questions">

              <!-- WHY -->
              <div class="golden-field">
                <div class="golden-question-header">
                  <span class="golden-label">WHY</span>
                  <h3>Por que você faz o que você faz?</h3>
                  <p class="golden-subtitle">Qual o propósito?</p>
                </div>
                <textarea
                  class="golden-input"
                  [(ngModel)]="goldenCircle.why"
                  placeholder="Descreva seu propósito, sua razão de ser..."
                  rows="4"></textarea>
              </div>

              <!-- HOW -->
              <div class="golden-field">
                <div class="golden-question-header">
                  <span class="golden-label">HOW</span>
                  <h3>Como você faz o que você faz?</h3>
                  <p class="golden-subtitle">Seu processo.</p>
                </div>
                <textarea
                  class="golden-input"
                  [(ngModel)]="goldenCircle.how"
                  placeholder="Descreva seu processo, como você opera..."
                  rows="4"></textarea>
              </div>

              <!-- WHAT -->
              <div class="golden-field">
                <div class="golden-question-header">
                  <span class="golden-label">WHAT</span>
                  <h3>O que você faz?</h3>
                  <p class="golden-subtitle">Seu resultado.</p>
                </div>
                <textarea
                  class="golden-input"
                  [(ngModel)]="goldenCircle.what"
                  placeholder="Descreva o que você faz, seus resultados..."
                  rows="4"></textarea>
              </div>

            </div>

          </div>

          <!-- Botões -->
          <div class="golden-circle-actions">
            <button
              type="button"
              class="btn-save-golden"
              (click)="salvarGoldenCircle()"
              [disabled]="salvandoGoldenCircle">
              <i class="fa-solid" [ngClass]="salvandoGoldenCircle ? 'fa-spinner fa-spin' : 'fa-save'"></i>
              {{ salvandoGoldenCircle ? 'Salvando...' : 'Salvar' }}
            </button>

            <button
              type="button"
              class="btn-export-golden"
              (click)="exportarGoldenCirclePDF()">
              <i class="fa-solid fa-file-pdf"></i>
              Exportar PDF
            </button>
          </div>

        </div>
      </div>
    </section>

    <!-- Roda da Vida MAAS Section -->
    <section *ngIf="secaoId === 'rodaDaVida'" class="dark-section roda-da-vida-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.rodaDaVida?.ativo">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-dharmachakra"></i>
            Roda da Vida MAAS®
          </h2>
          <p class="dark-subtitle">Mapa de Autoavaliação Sistêmico - "A Única Coisa"</p>
        </div>

        <div class="roda-da-vida-content">

          <!-- Layout: 2 Colunas -->
          <div class="roda-two-columns">

            <!-- Coluna Esquerda: Gráfico -->
            <div class="roda-left-side">
              <!-- Canvas da Roda (sem limites de container) -->
              <div class="roda-canvas-wrapper">
                <canvas id="rodaDaVidaCanvas" width="550" height="550"></canvas>
              </div>
            </div>

            <!-- Coluna Direita: Controles das Áreas -->
            <div class="roda-right-side">
              <div class="roda-controls-header">
                <h3 class="roda-controls-title">
                  <i class="fa-solid fa-sliders"></i>
                  Avalie suas Áreas
                </h3>
                <p class="roda-controls-subtitle">
                  Ajuste os valores de 1 a 10 usando o slider ou digitando diretamente
                </p>
              </div>

              <div class="roda-controls-list">
                <div *ngFor="let area of rodaDaVidaAreas" class="roda-control-item">
                  <div class="roda-control-header">
                    <label class="roda-control-label">{{ area.label }}</label>
                    <input
                      type="number"
                      min="1"
                      max="10"
                      class="roda-control-input"
                      [(ngModel)]="rodaDaVida[area.key].score"
                      (input)="onRodaDaVidaSliderChange(area.key)">
                  </div>
                  <p class="roda-control-hint">{{ area.hint }}</p>
                  <div class="roda-control-slider-wrapper">
                    <span class="roda-control-min">1</span>
                    <input
                      type="range"
                      min="1"
                      max="10"
                      step="1"
                      class="roda-control-slider"
                      [(ngModel)]="rodaDaVida[area.key].score"
                      (input)="onRodaDaVidaSliderChange(area.key)">
                    <span class="roda-control-max">10</span>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <!-- Card de Resumo (largura total abaixo das colunas) -->
          <div class="roda-resume-card">
            <h3 class="roda-resume-title">
              <i class="fa-solid fa-chart-line"></i>
              Resumo Geral
            </h3>
            <div class="roda-resume-stats">
              <div class="roda-stat-item">
                <span class="roda-stat-label">Média Geral</span>
                <span class="roda-stat-value roda-stat-primary">{{ calcularMediaRodaDaVida() | number:'1.1-1' }}</span>
              </div>
              <div class="roda-stat-item">
                <span class="roda-stat-label">Maior Área</span>
                <span class="roda-stat-value">{{ getMelhorAreaRodaDaVida() }}</span>
              </div>
              <div class="roda-stat-item">
                <span class="roda-stat-label">Menor Área</span>
                <span class="roda-stat-value">{{ getPiorAreaRodaDaVida() }}</span>
              </div>
            </div>
          </div>

          <!-- Seção: Decisões -->
          <div class="roda-decisions-section">
            <h3 class="roda-section-title">
              <i class="fa-solid fa-lightbulb"></i>
              Suas Decisões e Ações
            </h3>
            <p class="roda-section-subtitle">
              Para cada área, defina que decisão você tomará para melhorar
            </p>

            <div class="roda-decisions-grid">
              <div *ngFor="let area of rodaDaVidaAreas" class="roda-decision-item">
                <label class="roda-decision-label">
                  <i class="fa-solid fa-circle-dot"></i>
                  {{ area.label }}
                </label>
                <textarea
                  class="roda-decision-input"
                  [(ngModel)]="rodaDaVida[area.key].note"
                  placeholder="Qual decisão vou tomar para esta área?"
                  rows="3"></textarea>
              </div>

              <!-- Pergunta Especial -->
              <div class="roda-decision-item roda-special-question">
                <label class="roda-decision-label roda-special-label">
                  <i class="fa-solid fa-star"></i>
                  Que fichas caem?
                </label>
                <textarea
                  class="roda-decision-input"
                  [(ngModel)]="rodaDaVida.fichas_caem"
                  placeholder="Quais áreas da minha vida serão impactadas positivamente quando eu melhorar essa área principal?"
                  rows="4"></textarea>
              </div>
            </div>
          </div>

          <!-- Botões de Ação -->
          <div class="roda-actions">
            <button
              type="button"
              class="btn-save-roda"
              (click)="salvarRodaDaVida()"
              [disabled]="salvandoRodaDaVida">
              <i class="fa-solid" [ngClass]="salvandoRodaDaVida ? 'fa-spinner fa-spin' : 'fa-save'"></i>
              {{ salvandoRodaDaVida ? 'Salvando...' : 'Salvar Roda da Vida' }}
            </button>

            <button
              type="button"
              class="btn-export-roda"
              (click)="exportarRodaDaVidaPDF()">
              <i class="fa-solid fa-file-pdf"></i>
              Exportar PDF
            </button>
          </div>

          <!-- Nota Legal -->
          <p class="roda-legal-hint">
            <i class="fa-solid fa-info-circle"></i>
            Campos e nomes inspirados no Mapa de Autoavaliação Sistêmico – MAAS® / "A Única Coisa". Uso pessoal.
          </p>

        </div>
      </div>
    </section>

    <!-- Termômetro de Gestão Section -->
    <section *ngIf="secaoId === 'termometroGestao'" class="dark-section termometro-gestao-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.termometroGestao?.ativo">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-chart-column"></i>
            Termômetro de Gestão
          </h2>
          <p class="dark-subtitle">Classifique suas atividades e compare com perfis de referência</p>
        </div>

        <div class="termometro-gestao-content">

          <!-- Layout Principal: 2 Colunas -->
          <div class="termometro-main-grid">

            <!-- Coluna Esquerda: Formulário e Lista -->
            <div class="termometro-left-column">
              <div class="termometro-card">
                <h3 class="termometro-card-title">Adicionar Atividades</h3>

                <div class="termometro-form-group">
                  <input
                    type="text"
                    class="termometro-input"
                    [(ngModel)]="novaAtividade"
                    (keyup.enter)="adicionarAtividade()"
                    placeholder="Nome da atividade"
                    [disabled]="expired">

                  <select
                    class="termometro-select"
                    [(ngModel)]="novaAtividadeCategoria"
                    [disabled]="expired">
                    <option value="strategic">Estratégico</option>
                    <option value="tactical">Tático</option>
                    <option value="operational">Operacional</option>
                  </select>

                  <button
                    class="termometro-btn-add"
                    (click)="adicionarAtividade()"
                    [disabled]="expired">
                    <i class="fa-solid fa-plus"></i>
                  </button>
                </div>

                <!-- Lista de Atividades -->
                <div class="termometro-activity-list" *ngIf="termometroGestao.atividades.length > 0">
                  <div
                    *ngFor="let atividade of termometroGestao.atividades"
                    class="termometro-activity-item">
                    <span class="termometro-activity-name">{{ atividade.nome }}</span>
                    <span class="termometro-activity-badge" [ngClass]="getCategoriaClass(atividade.categoria)">
                      {{ getCategoriaNome(atividade.categoria) }}
                    </span>
                    <button
                      class="termometro-activity-remove-btn"
                      (click)="removerAtividade(atividade.id)"
                      [disabled]="expired"
                      title="Remover atividade">
                      ×
                    </button>
                  </div>
                </div>

                <p *ngIf="termometroGestao.atividades.length === 0" class="termometro-empty-message">
                  Nenhuma atividade adicionada. Clique em "Adicionar" para começar.
                </p>
              </div>
            </div>

            <!-- Coluna Direita: Resumo e Perfil -->
            <div class="termometro-right-column">
              <div class="termometro-card">
                <h3 class="termometro-card-title">Resumo das Atividades</h3>

                <!-- Contadores -->
                <div class="termometro-counters">
                  <div class="termometro-counter-item">
                    <div class="termometro-counter-value">{{ getAtividadesEstrategicasCount() }}</div>
                    <div class="termometro-counter-label">Estratégicas</div>
                  </div>
                  <div class="termometro-counter-item">
                    <div class="termometro-counter-value">{{ getAtividadesTaticasCount() }}</div>
                    <div class="termometro-counter-label">Táticas</div>
                  </div>
                  <div class="termometro-counter-item">
                    <div class="termometro-counter-value">{{ getAtividadesOperacionaisCount() }}</div>
                    <div class="termometro-counter-label">Operacionais</div>
                  </div>
                </div>

                <!-- Resumo de Percentuais -->
                <div class="termometro-summary-box">
                  <h4 class="termometro-summary-subtitle">Distribuição Atual</h4>
                  <div class="termometro-summary-grid">
                    <div class="termometro-summary-item">
                      <div class="termometro-summary-value strategic">{{ termometroGestao.percentualEstrategico }}%</div>
                      <div class="termometro-summary-label">Estratégico</div>
                    </div>
                    <div class="termometro-summary-item">
                      <div class="termometro-summary-value">{{ termometroGestao.percentualTatico }}%</div>
                      <div class="termometro-summary-label">Tático</div>
                    </div>
                    <div class="termometro-summary-item">
                      <div class="termometro-summary-value">{{ termometroGestao.percentualOperacional }}%</div>
                      <div class="termometro-summary-label">Operacional</div>
                    </div>
                  </div>
                </div>

                <!-- Perfil de Comparação -->
                <div class="termometro-perfil-select">
                  <label>Perfil de comparação</label>
                  <select
                    class="termometro-select-full"
                    [(ngModel)]="termometroGestao.perfilComparacao"
                    (change)="onPerfilComparacaoChange()"
                    [disabled]="expired">
                    <option value="direção">Direção</option>
                    <option value="gerencial">Gerencial</option>
                    <option value="profissional">Profissional/Suporte</option>
                  </select>
                </div>

                <!-- Botão Gerar Análise -->
                <button
                  class="termometro-btn-calculate"
                  (click)="salvarTermometroGestao()"
                  [disabled]="salvandoTermometro || expired || termometroGestao.atividades.length === 0">
                  <i class="fa-solid" [ngClass]="salvandoTermometro ? 'fa-spinner fa-spin' : 'fa-chart-line'"></i>
                  {{ salvandoTermometro ? 'Salvando...' : 'Gerar Análise' }}
                </button>
              </div>
            </div>

          </div>

          <!-- Visualização de Gráficos e Análise (se houver atividades) -->
          <div class="termometro-charts-container" *ngIf="termometroGestao.atividades.length > 0">

            <!-- Gráficos de Perfil -->
            <div class="termometro-profiles-grid">

              <!-- Seu Perfil Atual -->
              <div class="termometro-profile-card">
                <h3 class="termometro-profile-title">Seu Perfil Atual</h3>

                <!-- Donut Chart -->
                <div class="termometro-donut-chart" id="userDonutTermometro" #userDonutTermometro>
                  <svg width="200" height="200" viewBox="0 0 200 200">
                    <circle cx="100" cy="100" r="80" fill="none" stroke="#f5f5f5" stroke-width="30"/>
                  </svg>
                  <div class="termometro-donut-center">
                    <div class="termometro-donut-value" id="userMainPercentTermometro">0%</div>
                    <div class="termometro-donut-label" id="userMainLabelTermometro">-</div>
                  </div>
                </div>

                <!-- Barra de Perfil -->
                <div class="termometro-profile-bar-wrapper">
                  <div class="termometro-profile-header">SEU PERFIL</div>
                  <div class="termometro-profile-segments" id="userProfileTermometro">
                    <!-- Preenchido dinamicamente -->
                  </div>
                </div>

                <!-- Legenda -->
                <div class="termometro-legend">
                  <div class="termometro-legend-item">
                    <div class="termometro-legend-color strategic"></div>
                    <span>Estratégico</span>
                  </div>
                  <div class="termometro-legend-item">
                    <div class="termometro-legend-color tactical"></div>
                    <span>Tático</span>
                  </div>
                  <div class="termometro-legend-item">
                    <div class="termometro-legend-color operational"></div>
                    <span>Operacional</span>
                  </div>
                </div>
              </div>

              <!-- Perfil de Referência -->
              <div class="termometro-profile-card">
                <h3 class="termometro-profile-title">Perfil de Referência</h3>

                <!-- Donut Chart -->
                <div class="termometro-donut-chart" id="referenceDonutTermometro" #referenceDonutTermometro>
                  <svg width="200" height="200" viewBox="0 0 200 200">
                    <circle cx="100" cy="100" r="80" fill="none" stroke="#f5f5f5" stroke-width="30"/>
                  </svg>
                  <div class="termometro-donut-center">
                    <div class="termometro-donut-value" id="refMainPercentTermometro">0%</div>
                    <div class="termometro-donut-label" id="refMainLabelTermometro">-</div>
                  </div>
                </div>

                <!-- Barra de Perfil -->
                <div class="termometro-profile-bar-wrapper">
                  <div class="termometro-profile-header" id="referenceTitleTermometro">DIREÇÃO</div>
                  <div class="termometro-profile-segments" id="referenceProfileTermometro">
                    <!-- Preenchido dinamicamente -->
                  </div>
                </div>

                <!-- Legenda -->
                <div class="termometro-legend">
                  <div class="termometro-legend-item">
                    <div class="termometro-legend-color strategic"></div>
                    <span>Estratégico</span>
                  </div>
                  <div class="termometro-legend-item">
                    <div class="termometro-legend-color tactical"></div>
                    <span>Tático</span>
                  </div>
                  <div class="termometro-legend-item">
                    <div class="termometro-legend-color operational"></div>
                    <span>Operacional</span>
                  </div>
                </div>
              </div>

            </div>

            <!-- Análise Comparativa -->
            <div class="termometro-comparison-card">
              <div class="termometro-comparison-header">
                <h3 class="termometro-comparison-title">Análise Comparativa</h3>
                <button
                  class="btn-export-termometro"
                  (click)="exportarTermometroGestaoPDF()"
                  [disabled]="termometroGestao.atividades.length === 0">
                  <i class="fa-solid fa-file-pdf"></i>
                  Exportar PDF
                </button>
              </div>

              <div class="termometro-comparison-grid">
                <!-- Card Estratégico -->
                <div class="termometro-comparison-item strategic">
                  <h4>Estratégico</h4>
                  <div class="comparison-diff-main">{{ getComparacaoDiff('strategic') > 0 ? '+' : '' }}{{ getComparacaoDiff('strategic') }}%</div>
                  <div class="comparison-values">
                    <div>Atual: {{ termometroGestao.percentualEstrategico }}%</div>
                    <div>Referência: {{ perfisReferencia[termometroGestao.perfilComparacao].strategic }}%</div>
                  </div>
                  <div class="comparison-status" [ngClass]="getComparacaoStatus(getComparacaoDiff('strategic'))">
                    {{ getComparacaoLabel(getComparacaoDiff('strategic')) }}
                  </div>
                </div>

                <!-- Card Tático -->
                <div class="termometro-comparison-item tactical">
                  <h4>Tático</h4>
                  <div class="comparison-diff-main">{{ getComparacaoDiff('tactical') > 0 ? '+' : '' }}{{ getComparacaoDiff('tactical') }}%</div>
                  <div class="comparison-values">
                    <div>Atual: {{ termometroGestao.percentualTatico }}%</div>
                    <div>Referência: {{ perfisReferencia[termometroGestao.perfilComparacao].tactical }}%</div>
                  </div>
                  <div class="comparison-status" [ngClass]="getComparacaoStatus(getComparacaoDiff('tactical'))">
                    {{ getComparacaoLabel(getComparacaoDiff('tactical')) }}
                  </div>
                </div>

                <!-- Card Operacional -->
                <div class="termometro-comparison-item operational">
                  <h4>Operacional</h4>
                  <div class="comparison-diff-main">{{ getComparacaoDiff('operational') > 0 ? '+' : '' }}{{ getComparacaoDiff('operational') }}%</div>
                  <div class="comparison-values">
                    <div>Atual: {{ termometroGestao.percentualOperacional }}%</div>
                    <div>Referência: {{ perfisReferencia[termometroGestao.perfilComparacao].operational }}%</div>
                  </div>
                  <div class="comparison-status" [ngClass]="getComparacaoStatus(getComparacaoDiff('operational'))">
                    {{ getComparacaoLabel(getComparacaoDiff('operational')) }}
                  </div>
                </div>
              </div>
            </div>

          </div>

        </div>
      </div>
    </section>

    <!-- Ganhos e Perdas Section -->
    <section *ngIf="secaoId === 'ganhosPerdas'" class="dark-section ganhos-perdas-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.ganhosPerdas?.ativo">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-scale-balanced"></i>
            Ganhos e Perdas
          </h2>
          <p class="dark-subtitle">Matriz de Decisão Estratégica</p>
        </div>

        <div class="ganhos-perdas-content">

          <!-- Campo de Meta -->
          <div class="ganhos-perdas-meta-section">
            <label class="ganhos-perdas-meta-label">META:</label>
            <input
              type="text"
              class="ganhos-perdas-meta-input"
              [(ngModel)]="ganhosPerdas.meta"
              placeholder="Digite sua meta aqui..."
              [disabled]="expired">
          </div>

          <!-- Grid 2x2 dos Quadrantes -->
          <div class="ganhos-perdas-grid">

            <!-- Quadrante 1: Ganhos se Obtiver -->
            <div class="ganhos-perdas-quadrant ganhos-perdas-q1">
              <div class="ganhos-perdas-quadrant-title">O QUE VOCÊ GANHA SE OBTIVER ISTO?</div>
              <div class="ganhos-perdas-quadrant-subtitle">(busca do prazer)</div>

              <div class="ganhos-perdas-items">
                <div *ngFor="let item of ganhosPerdas.ganhos_obtiver; let i = index" class="ganhos-perdas-item">
                  <span class="ganhos-perdas-number">{{ i + 1 }}.</span>
                  <textarea
                    class="ganhos-perdas-textarea"
                    [(ngModel)]="item.texto"
                    placeholder="Digite aqui..."
                    [disabled]="expired"
                    rows="2"></textarea>
                  <button
                    class="ganhos-perdas-btn-remove"
                    (click)="removerItemGanhosPerdas('ganhos_obtiver', item.id)"
                    [disabled]="expired || ganhosPerdas.ganhos_obtiver.length <= 1"
                    title="Remover linha">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </div>

              <button
                class="ganhos-perdas-btn-add"
                (click)="adicionarItemGanhosPerdas('ganhos_obtiver')"
                [disabled]="expired">
                <i class="fa-solid fa-plus"></i>
                Adicionar linha
              </button>
            </div>

            <!-- Quadrante 2: Perdas se Obtiver -->
            <div class="ganhos-perdas-quadrant ganhos-perdas-q2">
              <div class="ganhos-perdas-quadrant-title">O QUE VOCÊ PERDE SE OBTIVER ISTO?</div>
              <div class="ganhos-perdas-quadrant-subtitle">(perda de valores)</div>

              <div class="ganhos-perdas-items">
                <div *ngFor="let item of ganhosPerdas.perdas_obtiver; let i = index" class="ganhos-perdas-item">
                  <span class="ganhos-perdas-number">{{ i + 1 }}.</span>
                  <textarea
                    class="ganhos-perdas-textarea"
                    [(ngModel)]="item.texto"
                    placeholder="Digite aqui..."
                    [disabled]="expired"
                    rows="2"></textarea>
                  <button
                    class="ganhos-perdas-btn-remove"
                    (click)="removerItemGanhosPerdas('perdas_obtiver', item.id)"
                    [disabled]="expired || ganhosPerdas.perdas_obtiver.length <= 1"
                    title="Remover linha">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </div>

              <button
                class="ganhos-perdas-btn-add"
                (click)="adicionarItemGanhosPerdas('perdas_obtiver')"
                [disabled]="expired">
                <i class="fa-solid fa-plus"></i>
                Adicionar linha
              </button>
            </div>

            <!-- Quadrante 3: Ganhos se NÃO Obtiver -->
            <div class="ganhos-perdas-quadrant ganhos-perdas-q3">
              <div class="ganhos-perdas-quadrant-title">O QUE VOCÊ GANHA SE NÃO OBTIVER ISTO?</div>
              <div class="ganhos-perdas-quadrant-subtitle">(sabotadores)</div>

              <div class="ganhos-perdas-items">
                <div *ngFor="let item of ganhosPerdas.ganhos_nao_obtiver; let i = index" class="ganhos-perdas-item">
                  <span class="ganhos-perdas-number">{{ i + 1 }}.</span>
                  <textarea
                    class="ganhos-perdas-textarea"
                    [(ngModel)]="item.texto"
                    placeholder="Digite aqui..."
                    [disabled]="expired"
                    rows="2"></textarea>
                  <button
                    class="ganhos-perdas-btn-remove"
                    (click)="removerItemGanhosPerdas('ganhos_nao_obtiver', item.id)"
                    [disabled]="expired || ganhosPerdas.ganhos_nao_obtiver.length <= 1"
                    title="Remover linha">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </div>

              <button
                class="ganhos-perdas-btn-add"
                (click)="adicionarItemGanhosPerdas('ganhos_nao_obtiver')"
                [disabled]="expired">
                <i class="fa-solid fa-plus"></i>
                Adicionar linha
              </button>
            </div>

            <!-- Quadrante 4: Perdas se NÃO Obtiver -->
            <div class="ganhos-perdas-quadrant ganhos-perdas-q4">
              <div class="ganhos-perdas-quadrant-title">O QUE VOCÊ PERDE SE NÃO OBTIVER ISTO?</div>
              <div class="ganhos-perdas-quadrant-subtitle">(motivadores-dor)</div>

              <div class="ganhos-perdas-items">
                <div *ngFor="let item of ganhosPerdas.perdas_nao_obtiver; let i = index" class="ganhos-perdas-item">
                  <span class="ganhos-perdas-number">{{ i + 1 }}.</span>
                  <textarea
                    class="ganhos-perdas-textarea"
                    [(ngModel)]="item.texto"
                    placeholder="Digite aqui..."
                    [disabled]="expired"
                    rows="2"></textarea>
                  <button
                    class="ganhos-perdas-btn-remove"
                    (click)="removerItemGanhosPerdas('perdas_nao_obtiver', item.id)"
                    [disabled]="expired || ganhosPerdas.perdas_nao_obtiver.length <= 1"
                    title="Remover linha">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </div>

              <button
                class="ganhos-perdas-btn-add"
                (click)="adicionarItemGanhosPerdas('perdas_nao_obtiver')"
                [disabled]="expired">
                <i class="fa-solid fa-plus"></i>
                Adicionar linha
              </button>
            </div>

          </div>

          <!-- Botões de Ação -->
          <div class="ganhos-perdas-actions">
            <button
              type="button"
              class="btn-save-ganhos-perdas"
              (click)="salvarGanhosPerdas()"
              [disabled]="salvandoGanhosPerdas || expired">
              <i class="fa-solid" [ngClass]="salvandoGanhosPerdas ? 'fa-spinner fa-spin' : 'fa-save'"></i>
              {{ salvandoGanhosPerdas ? 'Salvando...' : 'Salvar Ganhos e Perdas' }}
            </button>

            <button
              type="button"
              class="btn-export-ganhos-perdas"
              (click)="exportarGanhosPerdasPDF()">
              <i class="fa-solid fa-file-pdf"></i>
              Exportar PDF
            </button>
          </div>

        </div>
      </div>
    </section>

    <!-- Controle de Hábitos Section -->
    <section *ngIf="secaoId === 'controleHabitos'" class="dark-section controle-habitos-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.controleHabitos?.ativo">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-calendar-check"></i>
            Controle de Hábitos
          </h2>
          <p class="dark-subtitle">Rastreador Mensal de Hábitos</p>
        </div>

        <div class="controle-habitos-content">

          <!-- Período e Controles -->
          <div class="habitos-header-section">
            <div class="habitos-period-display">
              {{ getNomeMes(controleHabitos.mes) }} de {{ controleHabitos.ano }}
            </div>

            <div class="habitos-controls">
              <div class="habitos-date-selectors">
                <input
                  type="number"
                  class="habitos-year-input"
                  [(ngModel)]="controleHabitos.ano"
                  (change)="atualizarMesHabitos()"
                  min="2020"
                  max="2030"
                  placeholder="Ano"
                  [disabled]="expired">

                <select
                  class="habitos-month-select"
                  [(ngModel)]="controleHabitos.mes"
                  (change)="atualizarMesHabitos()"
                  [disabled]="expired">
                  <option [value]="0">Janeiro</option>
                  <option [value]="1">Fevereiro</option>
                  <option [value]="2">Março</option>
                  <option [value]="3">Abril</option>
                  <option [value]="4">Maio</option>
                  <option [value]="5">Junho</option>
                  <option [value]="6">Julho</option>
                  <option [value]="7">Agosto</option>
                  <option [value]="8">Setembro</option>
                  <option [value]="9">Outubro</option>
                  <option [value]="10">Novembro</option>
                  <option [value]="11">Dezembro</option>
                </select>
              </div>

              <button
                class="habitos-btn-add-habit"
                (click)="adicionarHabito()"
                [disabled]="expired">
                <i class="fa-solid fa-plus"></i>
                Adicionar Hábito
              </button>
            </div>
          </div>

          <!-- Estatísticas -->
          <div class="habitos-statistics">
            <h3 class="habitos-stats-title">
              <i class="fa-solid fa-chart-bar"></i>
              Estatísticas do Mês
            </h3>
            <div class="habitos-stats-grid">
              <div class="habitos-stat-card">
                <div class="habitos-stat-value">{{ controleHabitos.habitos.length }}</div>
                <div class="habitos-stat-label">Total de Hábitos</div>
              </div>
              <div class="habitos-stat-card">
                <div class="habitos-stat-value">{{ getMetasAlcancadas() }}/{{ controleHabitos.habitos.length }}</div>
                <div class="habitos-stat-label">Metas Alcançadas</div>
              </div>
              <div class="habitos-stat-card">
                <div class="habitos-stat-value">{{ getTotalDiasRealizados() }}</div>
                <div class="habitos-stat-label">Total Realizado</div>
              </div>
              <div class="habitos-stat-card">
                <div class="habitos-stat-value">{{ getTaxaConclusao() }}%</div>
                <div class="habitos-stat-label">Taxa de Conclusão</div>
              </div>
            </div>
          </div>

          <!-- Legenda -->
          <div class="habitos-legend">
            <div class="habitos-legend-item">
              <div class="habitos-legend-box habitos-done"></div>
              <span>Feito</span>
            </div>
            <div class="habitos-legend-item">
              <div class="habitos-legend-box habitos-not-done"></div>
              <span>Não Feito</span>
            </div>
            <div class="habitos-legend-item">
              <div class="habitos-legend-box habitos-not-needed"></div>
              <span>Não Necessário</span>
            </div>
            <div class="habitos-legend-item">
              <div class="habitos-legend-box habitos-empty"></div>
              <span>Clique para alternar</span>
            </div>
          </div>

          <!-- Tabela de Hábitos -->
          <div class="habitos-table-wrapper">
            <table class="habitos-table">
              <thead>
                <tr>
                  <th class="habitos-th-habit">Hábito</th>
                  <th class="habitos-th-goal">Meta / Progresso</th>
                  <th *ngFor="let dia of getDiasArray()" class="habitos-th-day">{{ dia }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let habito of controleHabitos.habitos" class="habitos-row">
                  <!-- Nome do Hábito -->
                  <td class="habitos-td-name">
                    <div class="habitos-name-container">
                      <div class="habitos-name-display">
                        <strong>{{ habito.nome }}</strong>
                        <span *ngIf="habito.descricao" class="habitos-description">{{ habito.descricao }}</span>
                      </div>
                      <button
                        class="habitos-btn-delete"
                        (click)="removerHabito(habito.id)"
                        [disabled]="expired"
                        title="Remover hábito">
                        <i class="fa-solid fa-trash"></i>
                      </button>
                    </div>
                    <div class="habitos-progress-container">
                      <div class="habitos-progress-bar">
                        <div
                          class="habitos-progress-fill"
                          [class.habitos-goal-reached]="getHabitoProgresso(habito) >= habito.meta"
                          [style.width.%]="getHabitoProgressoPercentual(habito)"></div>
                      </div>
                    </div>
                  </td>

                  <!-- Meta / Progresso -->
                  <td class="habitos-td-goal">
                    <div class="habitos-goal-container">
                      <div class="habitos-goal-label">META</div>
                      <div class="habitos-goal-value">{{ habito.meta }}</div>
                      <div class="habitos-current-count">
                        {{ getHabitoProgresso(habito) }}/{{ habito.meta }}
                      </div>
                    </div>
                  </td>

                  <!-- Dias do Mês -->
                  <td
                    *ngFor="let diaData of habito.dias"
                    class="habitos-day-cell"
                    [class.habitos-done]="diaData.status === 'done'"
                    [class.habitos-not-done]="diaData.status === 'not-done'"
                    [class.habitos-not-needed]="diaData.status === 'not-needed'"
                    (click)="!expired && toggleDiaStatus(habito, diaData.dia)">
                  </td>
                </tr>

                <tr *ngIf="controleHabitos.habitos.length === 0">
                  <td [attr.colspan]="controleHabitos.totalDias + 2" class="habitos-empty-message">
                    Nenhum hábito adicionado. Clique em "Adicionar Hábito" para começar.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Botões de Ação -->
          <div class="habitos-actions">
            <button
              type="button"
              class="btn-save-habitos"
              (click)="salvarControleHabitos()"
              [disabled]="salvandoControleHabitos || expired">
              <i class="fa-solid" [ngClass]="salvandoControleHabitos ? 'fa-spinner fa-spin' : 'fa-save'"></i>
              {{ salvandoControleHabitos ? 'Salvando...' : 'Salvar Controle de Hábitos' }}
            </button>

            <button
              type="button"
              class="btn-export-habitos"
              (click)="exportarControleHabitosPDF()">
              <i class="fa-solid fa-file-pdf"></i>
              Exportar PDF
            </button>
          </div>

        </div>
      </div>
    </section>

    <!-- Modal para adicionar hábito -->
    <div class="modal-overlay" *ngIf="showAddHabitoModal" (click)="fecharModalHabito()">
      <div class="modal-habito-content" (click)="$event.stopPropagation()">
        <h2 class="modal-habito-title">Adicionar Novo Hábito</h2>
        <div class="modal-habito-form">
          <label>
            Nome do Hábito:
            <input
              type="text"
              [(ngModel)]="novoHabitoNome"
              placeholder="Ex: Exercícios físicos"
              [disabled]="expired"
              (keyup.enter)="confirmarAdicionarHabito()">
          </label>
          <label>
            Meta (quantas vezes por mês):
            <input
              type="number"
              [(ngModel)]="novoHabitoMeta"
              min="1"
              [max]="controleHabitos.totalDias"
              value="20"
              placeholder="Ex: 20"
              [disabled]="expired">
          </label>
          <label>
            Descrição (opcional):
            <textarea
              [(ngModel)]="novoHabitoDescricao"
              placeholder="Ex: 30 minutos de caminhada"
              [disabled]="expired"></textarea>
          </label>
        </div>
        <div class="modal-habito-buttons">
          <button class="modal-btn-cancel" (click)="fecharModalHabito()">Cancelar</button>
          <button class="modal-btn-confirm" (click)="confirmarAdicionarHabito()" [disabled]="expired">Adicionar</button>
        </div>
      </div>
    </div>

    <!-- Matriz RACI Section -->
    <section *ngIf="secaoId === 'matrizRaci'" class="dark-section matriz-raci-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.matrizRaci?.ativo">
      <div class="dark-container">
        <app-matriz-raci-editor
          [token]="token"
          [modoVisualizacao]="false">
        </app-matriz-raci-editor>
      </div>
    </section>

    <!-- Análise de Problemas Section -->
    <section *ngIf="secaoId === 'analiseProblemas'" class="dark-section analise-problemas-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.analiseProblemas?.ativo">
      <div class="dark-container">
        <app-analise-problemas
          [token]="token"
          [readOnly]="false">
        </app-analise-problemas>
      </div>
    </section>

    <!-- Erros Section -->
    <section *ngIf="secaoId === 'erros'" class="dark-section gestao-erros-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.erros?.ativo">
      <div class="dark-container">
        <app-gestao-erros
          [token]="token"
          [readOnly]="false">
        </app-gestao-erros>
      </div>
    </section>

    <!-- Mapa Mental Section -->
    <section *ngIf="secaoId === 'mapaMental'" class="dark-section mapa-mental-main-section"
             [class.hidden]="!conteudoEstruturado || !conteudoEstruturado.mapaMental?.ativo">
      <div class="dark-container">
        <div class="dark-header">
          <h2 class="dark-title">
            <i class="fa-solid fa-diagram-project"></i>
            PDM | Plano de Desenvolvimento de Metas
          </h2>
        </div>

        <!-- Controles -->
        <div class="mapa-mental-controls">
          <div class="controls-left">
            <button
              type="button"
              class="btn-add-nivel"
              (click)="adicionarNivelMapaMental()">
              <i class="fa-solid fa-plus"></i>
              Acrescentar Nível
            </button>
          </div>

          <div class="controls-right">
            <button
              type="button"
              class="btn-salvar-mapa"
              (click)="salvarMapaMentalManual()"
              [disabled]="salvandoMapaMental"
              title="Salvar alterações do mapa mental">
              <i class="fa-solid" [ngClass]="salvandoMapaMental ? 'fa-circle-notch fa-spin' : 'fa-save'"></i>
              {{ salvandoMapaMental ? 'Salvando...' : 'Salvar Mapa' }}
            </button>

            <!-- Dropdown de Exportação -->
            <div class="export-dropdown">
              <button
                type="button"
                class="btn-export-main"
                (click)="toggleExportDropdown()"
                [class.active]="showExportDropdown">
                <i class="fa-solid fa-download"></i>
                Exportar
                <i class="fa-solid fa-chevron-down dropdown-arrow" [class.rotated]="showExportDropdown"></i>
              </button>

              <div class="export-menu" *ngIf="showExportDropdown">
                <button
                  type="button"
                  class="export-option"
                  (click)="exportarMapaMentalPNG()">
                  <i class="fa-solid fa-image"></i>
                  <span>Exportar como PNG</span>
                </button>
                <button
                  type="button"
                  class="export-option"
                  (click)="exportarMapaMentalPDF()">
                  <i class="fa-solid fa-file-pdf"></i>
                  <span>Exportar como PDF</span>
                </button>
                <button
                  type="button"
                  class="export-option"
                  (click)="exportarMapaMentalICS()">
                  <i class="fa-solid fa-calendar-plus"></i>
                  <span>Exportar para Agenda (.ics)</span>
                </button>
                <button
                  type="button"
                  class="export-option"
                  (click)="exportarMapaMentalMarkdown()">
                  <i class="fa-brands fa-markdown"></i>
                  <span>Exportar para Notion (Markdown)</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Colunas e Cards -->
        <div class="mapa-mental-container">
          <div *ngFor="let coluna of conteudoEstruturado.mapaMental.data.colunas; trackBy: trackByFn" class="mapa-mental-coluna">
            <!-- Cabeçalho da Coluna -->
            <div class="coluna-header" [ngClass]="coluna.corBg">
              <h3>{{ coluna.nome }}</h3>
              <div class="coluna-header-actions">
                <button
                  type="button"
                  class="btn-add-card"
                  (click)="adicionarCardMapaMental(coluna.id)"
                  title="Adicionar card">
                  <i class="fa-solid fa-plus"></i>
                </button>
                <button
                  *ngIf="podeRemoverNivel(coluna.id)"
                  type="button"
                  class="btn-remove-nivel"
                  (click)="removerNivelMapaMental(coluna.id)"
                  title="Remover nível">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </div>

            <!-- Cards -->
            <div
              class="coluna-cards"
              cdkDropList
              [cdkDropListData]="conteudoEstruturado.mapaMental.data.cards[coluna.id]"
              (cdkDropListDropped)="onCardDrop($event, coluna.id)">
              <div
                *ngFor="let card of conteudoEstruturado.mapaMental.data.cards[coluna.id]; trackBy: trackByFn"
                cdkDrag
                class="mapa-mental-card"
                [class.conectando]="mapaMentalConectando === card.id"
                [ngClass]="coluna.corBorda"
                [attr.id]="'card-' + card.id">

                <div class="card-body">
                  <!-- Meta -->
                  <div class="form-group">
                    <label>Meta</label>
                    <textarea
                      class="form-textarea"
                      [value]="card.meta"
                      (input)="atualizarCardMapaMental(coluna.id, card.id, 'meta', $any($event.target).value)"
                      placeholder="Descreva a meta"
                      rows="2"></textarea>
                  </div>

                  <!-- Indicador de Sucesso -->
                  <div class="form-group">
                    <label>IS</label>
                    <textarea
                      class="form-textarea"
                      [value]="card.indicador"
                      (input)="atualizarCardMapaMental(coluna.id, card.id, 'indicador', $any($event.target).value)"
                      placeholder="Indicador de sucesso"
                      rows="2"></textarea>
                  </div>

                  <!-- Prazo -->
                  <div class="form-group">
                    <label>Prazo</label>
                    <input
                      type="date"
                      class="form-input"
                      [value]="card.prazo"
                      (input)="atualizarCardMapaMental(coluna.id, card.id, 'prazo', $any($event.target).value)">
                  </div>

                  <!-- Ações do Card -->
                  <div class="card-actions">
                    <button
                      type="button"
                      class="btn-conectar"
                      [class.active]="mapaMentalConectando === card.id"
                      (click)="iniciarConexaoMapaMental(card.id)">
                      <i class="fa-solid fa-arrow-right"></i>
                      {{ mapaMentalConectando === card.id ? 'Conectando...' : 'Conectar' }}
                    </button>
                    <button
                      type="button"
                      class="btn-remove"
                      (click)="removerCardMapaMental(coluna.id, card.id)">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>

                  <!-- Conexões -->
                  <div *ngIf="obterConexoesDoCard(card.id).length > 0" class="card-conexoes">
                    <p class="conexoes-label">CONEXÕES:</p>
                    <div class="conexoes-badges">
                      <span
                        *ngFor="let conexao of obterConexoesDoCard(card.id); let i = index"
                        class="conexao-badge">
                        → {{ obterNomeColunaDoCard(conexao.para) }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <p *ngIf="!conteudoEstruturado.mapaMental.data.cards[coluna.id] || conteudoEstruturado.mapaMental.data.cards[coluna.id].length === 0"
                 class="empty-state-small">
                Clique em + para adicionar um card
              </p>
            </div>
          </div>
        </div>

        <!-- Lista de Conexões -->
        <div *ngIf="conteudoEstruturado.mapaMental.data.conexoes.length > 0" class="conexoes-lista">
          <h3>Conexões Criadas</h3>
          <div
            *ngFor="let conexao of conteudoEstruturado.mapaMental.data.conexoes; let i = index"
            class="conexao-item">
            <div class="conexao-content">
              <div class="conexao-card-info">
                <strong class="conexao-meta">{{ obterCardPorId(conexao.de)?.meta || 'Card origem' }}</strong>
                <small class="conexao-nivel">{{ obterNomeColunaDoCard(conexao.de) }}</small>
              </div>
              <span class="conexao-arrow">→</span>
              <div class="conexao-card-info">
                <strong class="conexao-meta">{{ obterCardPorId(conexao.para)?.meta || 'Card destino' }}</strong>
                <small class="conexao-nivel">{{ obterNomeColunaDoCard(conexao.para) }}</small>
              </div>
            </div>
            <button
              type="button"
              class="btn-remove-conexao"
              (click)="removerConexaoMapaMental(i)">
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
        </div>

      </div>
    </section>

    </ng-container>
    <!-- FIM DAS SEÇÕES REORDENÁVEIS -->

    <!-- Encerramento Section -->
    <section class="encerramento-final-section"
             *ngIf="conteudoEstruturado && conteudoEstruturado.encerramento?.ativo && conteudoEstruturado.encerramento?.conteudo">
      <div class="encerramento-container">
        <div class="encerramento-content-new">
          <p>{{ conteudoEstruturado.encerramento.conteudo }}</p>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mentoria-footer">
      <p *ngIf="savingInteractions" class="saving-indicator">
        <i class="fa-solid fa-circle-notch fa-spin"></i>
        Salvando...
      </p>
      <p class="footer-info">
        <i class="fa-solid fa-shield-halved"></i>
        Suas informações são mantidas em sigilo
      </p>
      <p class="footer-copy">© {{ getCurrentYear() }} NAUE Consultoria - Todos os direitos reservados</p>
    </footer>

  </div>

  <!-- MODAL DE VISUALIZAÇÃO DE IMAGEM -->
  <div class="image-modal" *ngIf="modalImageSrc" (click)="closeImageModal()">
    <div class="image-modal-content" (click)="$event.stopPropagation()">
      <button class="image-modal-close" (click)="closeImageModal()">
        <i class="fas fa-times"></i>
      </button>
      <img [src]="modalImageSrc" alt="Imagem expandida">
    </div>
  </div>
</div>
