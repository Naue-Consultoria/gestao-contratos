<div class="page">

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Carregando encontro...</p>
  </div>

  <!-- Editor Content -->
  <div *ngIf="!isLoading && encontro">

    <!-- Header Padronizado -->
    <div class="page-header">
      <div class="header-title-section">
        <h1 class="page-title">Editar Conteúdo da Mentoria</h1>
        <app-breadcrumb></app-breadcrumb>
        <p class="subtitle">
          <i class="fas fa-user"></i>
          {{ encontro.mentorado_nome }} - Encontro #{{ encontro.numero_encontro }}
        </p>
      </div>
      <div class="header-actions">
        <button type="button" class="btn-secondary" (click)="voltar()">
          <i class="fas fa-arrow-left"></i>
          Voltar
        </button>
        <button type="button" class="btn-primary" (click)="salvarConteudo()" [disabled]="isSaving">
          <i class="fas fa-save"></i>
          {{ isSaving ? 'Salvando...' : 'Salvar' }}
        </button>
      </div>
    </div>

    <!-- Formulário -->
    <form class="editor-form">

      <!-- Barra de Ferramentas de Blocos -->
      <section class="editor-section">
        <div class="section-header">
          <span class="section-title">
            <i class="fa-solid fa-layer-group"></i>
            Adicionar Seções
          </span>
          <div class="section-header-actions">
            <button type="button" class="btn-toggle-toolbar" (click)="mostrarBarraFerramentas = !mostrarBarraFerramentas">
              <i class="fas" [class.fa-chevron-up]="mostrarBarraFerramentas" [class.fa-chevron-down]="!mostrarBarraFerramentas"></i>
            </button>
          </div>
        </div>

        <div class="section-content" *ngIf="mostrarBarraFerramentas">
          <div class="toolbar-grid">
            <button
              *ngFor="let bloco of blocosDisponiveis"
              type="button"
              class="toolbar-item"
              [class.toolbar-item-disabled]="isBlocoAdicionado(bloco.tipo)"
              [disabled]="isBlocoAdicionado(bloco.tipo)"
              (click)="adicionarBloco(bloco.tipo)"
              [title]="bloco.descricao">
              <i class="fas {{ bloco.icone }}"></i>
              <span>{{ bloco.titulo }}</span>
              <i *ngIf="isBlocoAdicionado(bloco.tipo)" class="fas fa-check toolbar-check"></i>
            </button>
          </div>
        </div>
      </section>

      <!-- Mensagem quando não há blocos -->
      <div *ngIf="blocosAtivos.length === 0" class="empty-state">
        <i class="fas fa-layer-group fa-3x"></i>
        <h3>Nenhuma seção adicionada</h3>
        <p>Clique nos botões acima para adicionar seções ao conteúdo da mentoria</p>
      </div>

      <!-- Blocos Dinâmicos -->
      <ng-container *ngFor="let bloco of blocosAtivos; let i = index">

        <!-- VISÃO GERAL -->
        <section *ngIf="bloco.tipo === 'visaoGeral'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <textarea
              class="form-textarea"
              [(ngModel)]="conteudo.visaoGeral.conteudo"
              name="visaoGeralConteudo"
              placeholder="Descreva a visão geral do encontro..."
              rows="4"></textarea>
          </div>
        </section>

        <!-- MENTORIA -->
        <section *ngIf="bloco.tipo === 'mentoria'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <textarea
              class="form-textarea"
              [(ngModel)]="conteudo.mentoria.conteudo"
              name="mentoriaConteudo"
              placeholder="Descreva o conteúdo da mentoria..."
              rows="6"></textarea>
          </div>
        </section>

        <!-- TESTES -->
        <section *ngIf="bloco.tipo === 'testes'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-add"
                (click)="adicionarTeste()">
                <i class="fa-solid fa-plus"></i>
                Adicionar Teste
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div *ngFor="let teste of conteudo.testes.itens; trackBy: trackByFn" class="teste-item">
              <div class="item-header">
                <button
                  type="button"
                  class="btn-remove"
                  (click)="removerTeste(teste.id)">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>

              <div class="form-group">
                <label>Nome do Teste</label>
                <input
                  type="text"
                  class="form-input"
                  [(ngModel)]="teste.nome"
                  [name]="'teste-nome-' + teste.id"
                  placeholder="Digite o nome do teste">
              </div>

              <div class="form-group">
                <label>Arquivo (Imagem ou PDF)</label>
                <input
                  type="file"
                  class="form-input-file"
                  accept="image/*,.pdf"
                  (change)="onArquivoSelected($event, teste)">
                <img
                  *ngIf="teste.imagemUrl && !teste.isPdf"
                  [src]="teste.imagemUrl"
                  class="image-preview"
                  alt="Preview">
                <div
                  *ngIf="teste.isPdf && teste.nomeArquivo"
                  class="pdf-preview">
                  <i class="fas fa-file-pdf"></i>
                  <span>{{ teste.nomeArquivo }}</span>
                </div>
              </div>

              <div class="form-group">
                <label>Comentário</label>
                <textarea
                  class="form-textarea"
                  [(ngModel)]="teste.comentario"
                  [name]="'teste-comentario-' + teste.id"
                  placeholder="Adicione um comentário sobre o teste..."
                  rows="3"></textarea>
              </div>
            </div>

            <p *ngIf="conteudo.testes.itens.length === 0" class="empty-state">
              Nenhum teste adicionado. Clique em "Adicionar Teste" para começar.
            </p>
          </div>
        </section>

        <!-- PRÓXIMOS PASSOS -->
        <section *ngIf="bloco.tipo === 'proximosPassos'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="btn-group">
              <button
                type="button"
                class="btn-add"
                (click)="adicionarBlocoProximosPassos('texto')">
                <i class="fa-solid fa-paragraph"></i>
                Texto
              </button>
              <button
                type="button"
                class="btn-add"
                (click)="adicionarBlocoProximosPassos('perguntas')">
                <i class="fa-solid fa-question"></i>
                Perguntas
              </button>
              <button
                type="button"
                class="btn-add"
                (click)="adicionarBlocoProximosPassos('tarefas')">
                <i class="fa-solid fa-list-check"></i>
                Tarefas
              </button>
              <button
                type="button"
                class="btn-templates"
                (click)="abrirGerenciadorTemplates()">
                <i class="fa-solid fa-folder-open"></i>
                Templates
              </button>
            </div>

            <!-- Blocos de Próximos Passos -->
            <div *ngFor="let blocoProx of conteudo.proximosPassos.blocos; let idx = index" class="bloco-item">
              <div class="item-header">
                <div class="item-header-left">
                  <div class="bloco-tipo-badge">
                    <div class="badge-content">
                      <div class="badge-tipo">
                        <i class="fa-solid"
                           [class.fa-paragraph]="blocoProx.tipo === 'texto'"
                           [class.fa-question]="blocoProx.tipo === 'perguntas'"
                           [class.fa-list-check]="blocoProx.tipo === 'tarefas'"></i>
                        <span>{{ blocoProx.tipo === 'texto' ? 'Texto' :
                               blocoProx.tipo === 'perguntas' ? 'Perguntas' : 'Tarefas' }}</span>
                      </div>
                      <div *ngIf="blocoProx.nomeTemplate" class="badge-template">
                        {{ blocoProx.nomeTemplate }}
                      </div>
                    </div>
                  </div>
                </div>
                <div class="item-header-right">
                  <button
                    type="button"
                    class="btn-reorder"
                    (click)="moverBlocoParaCima(idx)"
                    [disabled]="!podeSubir(idx)"
                    title="Mover para cima">
                    <i class="fa-solid fa-arrow-up"></i>
                  </button>
                  <button
                    type="button"
                    class="btn-reorder"
                    (click)="moverBlocoParaBaixo(idx)"
                    [disabled]="!podeDescer(idx)"
                    title="Mover para baixo">
                    <i class="fa-solid fa-arrow-down"></i>
                  </button>
                  <button
                    type="button"
                    class="btn-remove"
                    (click)="removerBlocoProximosPassos(blocoProx.id)">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </div>

              <!-- Conteúdo Texto com Editor Rico -->
              <div *ngIf="blocoProx.tipo === 'texto'" class="rich-editor-container">
                <div class="editor-toolbar">
                  <!-- Dropdown de Título -->
                  <div class="title-dropdown">
                    <button type="button"
                            class="toolbar-btn dropdown-toggle"
                            (click)="toggleTitleDropdown(blocoProx.id)"
                            title="Tamanho do texto">
                      <i class="fas fa-heading"></i>
                      <span>{{ selectedTitle[blocoProx.id] || 'Normal' }}</span>
                      <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="dropdown-menu" *ngIf="showTitleDropdown[blocoProx.id]">
                      <button type="button"
                              class="dropdown-item"
                              *ngFor="let option of titleOptions"
                              (click)="applyTitle(option, blocoProx.id)">
                        <span class="dropdown-icon">{{ option.icon }}</span>
                        {{ option.label }}
                      </button>
                    </div>
                  </div>
                  <div class="toolbar-separator"></div>
                  <button type="button" class="toolbar-btn" (click)="execCommand('bold')" title="Negrito">
                    <i class="fas fa-bold"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="execCommand('italic')" title="Itálico">
                    <i class="fas fa-italic"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="execCommand('underline')" title="Sublinhado">
                    <i class="fas fa-underline"></i>
                  </button>
                  <div class="toolbar-separator"></div>
                  <button type="button" class="toolbar-btn" (click)="execCommand('indent')" title="Aumentar Recuo">
                    <i class="fas fa-indent"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="execCommand('outdent')" title="Diminuir Recuo">
                    <i class="fas fa-outdent"></i>
                  </button>
                  <div class="toolbar-separator"></div>
                  <button type="button" class="toolbar-btn" (click)="execCommand('insertUnorderedList')" title="Lista">
                    <i class="fas fa-list-ul"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="execCommand('insertOrderedList')" title="Lista Numerada">
                    <i class="fas fa-list-ol"></i>
                  </button>
                  <div class="toolbar-separator"></div>
                  <button type="button" class="toolbar-btn" (click)="execCommand('undo')" title="Desfazer">
                    <i class="fas fa-undo"></i>
                  </button>
                  <button type="button" class="toolbar-btn" (click)="execCommand('redo')" title="Refazer">
                    <i class="fas fa-redo"></i>
                  </button>
                  <div class="toolbar-separator"></div>
                  <button type="button" class="toolbar-btn" (click)="insertLink()" title="Inserir Link">
                    <i class="fas fa-link"></i>
                  </button>
                  <label class="toolbar-btn" title="Inserir Imagem" style="margin: 0;">
                    <i class="fas fa-image"></i>
                    <input
                      type="file"
                      accept="image/*"
                      (change)="onEditorImageSelected($event, blocoProx)"
                      style="display: none;">
                  </label>
                </div>
                <div
                  #richEditor
                  class="rich-editor"
                  contenteditable="true"
                  (input)="onEditorInput($event, blocoProx)"
                  (dragover)="onDragOver($event)"
                  (dragleave)="onDragLeave($event)"
                  (drop)="onDrop($event, blocoProx)"
                  data-placeholder="Digite o conteúdo aqui..."></div>
              </div>

              <!-- Conteúdo Perguntas -->
              <div *ngIf="blocoProx.tipo === 'perguntas'">
                <div *ngFor="let pergunta of blocoProx.perguntas; let pIdx = index" class="pergunta-item">
                  <div class="pergunta-header">
                    <span>Pergunta {{ pIdx + 1 }}</span>
                    <button
                      type="button"
                      class="btn-remove-small"
                      (click)="removerPergunta(blocoProx, pIdx)"
                      [disabled]="blocoProx.perguntas!.length === 1">
                      <i class="fa-solid fa-times"></i>
                    </button>
                  </div>
                  <input
                    type="text"
                    class="form-input"
                    [(ngModel)]="pergunta.pergunta"
                    [name]="'pergunta-' + blocoProx.id + '-' + pIdx"
                    placeholder="Digite a pergunta...">
                </div>
                <button
                  type="button"
                  class="btn-add-small"
                  (click)="adicionarPergunta(blocoProx)">
                  <i class="fa-solid fa-plus"></i>
                  Adicionar Pergunta
                </button>
              </div>

              <!-- Conteúdo Tarefas -->
              <div *ngIf="blocoProx.tipo === 'tarefas'">
                <div class="form-group">
                  <label>Título das Tarefas</label>
                  <input
                    type="text"
                    class="form-input"
                    [(ngModel)]="blocoProx.tarefas!.titulo"
                    [name]="'tarefa-titulo-' + blocoProx.id"
                    placeholder="Ex: Tarefas para próxima semana">
                </div>
                <div class="tarefas-list">
                  <div *ngFor="let tarefa of blocoProx.tarefas!.itens; let tIdx = index" class="tarefa-item">
                    <input
                      type="text"
                      class="form-input"
                      [(ngModel)]="tarefa.texto"
                      [name]="'tarefa-' + blocoProx.id + '-' + tIdx"
                      placeholder="Descreva a tarefa...">
                    <button
                      type="button"
                      class="btn-remove-small"
                      (click)="removerTarefa(blocoProx, tIdx)"
                      [disabled]="blocoProx.tarefas!.itens.length === 1">
                      <i class="fa-solid fa-times"></i>
                    </button>
                  </div>
                  <button
                    type="button"
                    class="btn-add-small"
                    (click)="adicionarTarefa(blocoProx)">
                    <i class="fa-solid fa-plus"></i>
                    Adicionar Tarefa
                  </button>
                </div>
              </div>
            </div>

            <p *ngIf="conteudo.proximosPassos.blocos.length === 0" class="empty-state">
              Nenhum bloco adicionado. Use os botões acima para adicionar conteúdo.
            </p>
          </div>
        </section>

        <!-- REFERÊNCIAS -->
        <section *ngIf="bloco.tipo === 'referencias'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-add"
                (click)="adicionarReferencia()">
                <i class="fa-solid fa-plus"></i>
                Adicionar Referência
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div *ngFor="let referencia of conteudo.referencias.itens; trackBy: trackByFn" class="referencia-item">
              <div class="item-header">
                <button
                  type="button"
                  class="btn-remove"
                  (click)="removerReferencia(referencia.id)">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Tipo</label>
                  <select
                    class="form-select"
                    [(ngModel)]="referencia.tipo"
                    [name]="'ref-tipo-' + referencia.id">
                    <option value="ted">TED Talk</option>
                    <option value="livro">Livro</option>
                    <option value="leitura">Leitura</option>
                    <option value="video">Vídeo</option>
                    <option value="link">Link</option>
                    <option value="teste">Teste</option>
                    <option value="gymrats">GymRats</option>
                    <option value="outro">Outro</option>
                  </select>
                </div>

                <div class="form-group flex-grow">
                  <label>Título</label>
                  <input
                    type="text"
                    class="form-input"
                    [(ngModel)]="referencia.titulo"
                    [name]="'ref-titulo-' + referencia.id"
                    placeholder="Digite o título...">
                </div>
              </div>

              <div class="form-group">
                <label>Link</label>
                <input
                  type="url"
                  class="form-input"
                  [(ngModel)]="referencia.link"
                  [name]="'ref-link-' + referencia.id"
                  placeholder="https://...">
              </div>
            </div>

            <p *ngIf="conteudo.referencias.itens.length === 0" class="empty-state">
              Nenhuma referência adicionada. Clique em "Adicionar Referência" para começar.
            </p>
          </div>
        </section>

        <!-- MAPA MENTAL -->
        <section *ngIf="bloco.tipo === 'mapaMental'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="info-box">
              <i class="fas fa-check-circle"></i>
              <p>Mapa Mental ativado. O conteúdo será exibido na visualização pública da mentoria.</p>
            </div>
          </div>
        </section>

        <!-- MODELO ABC -->
        <section *ngIf="bloco.tipo === 'modeloABC'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="info-box">
              <i class="fas fa-check-circle"></i>
              <p>Modelo ABC ativado. O conteúdo será exibido na visualização pública da mentoria.</p>
            </div>
          </div>
        </section>

        <!-- ZONAS DE APRENDIZADO -->
        <section *ngIf="bloco.tipo === 'zonasAprendizado'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="info-box">
              <i class="fas fa-check-circle"></i>
              <p>Zonas de Aprendizado ativado. O conteúdo será exibido na visualização pública da mentoria.</p>
            </div>
          </div>
        </section>

        <!-- GOLDEN CIRCLE -->
        <section *ngIf="bloco.tipo === 'goldenCircle'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="info-box">
              <i class="fas fa-check-circle"></i>
              <p>Golden Circle ativado. O conteúdo será exibido na visualização pública da mentoria.</p>
            </div>
          </div>
        </section>

        <!-- RODA DA VIDA MAAS -->
        <section *ngIf="bloco.tipo === 'rodaDaVida'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="info-box">
              <i class="fas fa-check-circle"></i>
              <p>Roda da Vida MAAS® ativada. O conteúdo será exibido na visualização pública da mentoria.</p>
            </div>
          </div>
        </section>

        <!-- TERMÔMETRO DE GESTÃO -->
        <section *ngIf="bloco.tipo === 'termometroGestao'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="info-box">
              <i class="fas fa-check-circle"></i>
              <p>Termômetro de Gestão ativado. O conteúdo será exibido na visualização pública da mentoria.</p>
            </div>
          </div>
        </section>

        <!-- GANHOS E PERDAS -->
        <section *ngIf="bloco.tipo === 'ganhosPerdas'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="info-box">
              <i class="fas fa-check-circle"></i>
              <p>Ganhos e Perdas ativado. Matriz de Decisão Estratégica será exibida na visualização pública da mentoria.</p>
            </div>
          </div>
        </section>

        <!-- CONTROLE DE HÁBITOS -->
        <section *ngIf="bloco.tipo === 'controleHabitos'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="info-box">
              <i class="fas fa-check-circle"></i>
              <p>Controle de Hábitos ativado. Rastreador mensal será exibido na visualização pública da mentoria.</p>
            </div>
          </div>
        </section>

        <!-- MATRIZ RACI -->
        <section *ngIf="bloco.tipo === 'matrizRaci'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <div class="info-box">
              <i class="fas fa-check-circle"></i>
              <p>Matriz RACI ativada. A matriz de responsabilidades será exibida na visualização pública da mentoria.</p>
            </div>
          </div>
        </section>

        <!-- ENCERRAMENTO -->
        <section *ngIf="bloco.tipo === 'encerramento'" [id]="'bloco-' + bloco.id" class="editor-section">
          <div class="section-header">
            <span class="section-title">
              <i class="fa-solid {{ bloco.icone }}"></i>
              {{ bloco.titulo }}
            </span>
            <div class="section-header-actions">
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoCima(bloco.id)"
                [disabled]="!podeBlocoSubir(bloco.id)"
                title="Mover para cima">
                <i class="fa-solid fa-arrow-up"></i>
              </button>
              <button
                type="button"
                class="btn-reorder-section"
                (click)="moverBlocoBaixo(bloco.id)"
                [disabled]="!podeBlocoDescer(bloco.id)"
                title="Mover para baixo">
                <i class="fa-solid fa-arrow-down"></i>
              </button>
              <button
                type="button"
                class="btn-remove"
                (click)="removerBloco(bloco.id)"
                title="Remover seção">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
          </div>

          <div class="section-content">
            <textarea
              class="form-textarea"
              [(ngModel)]="conteudo.encerramento.conteudo"
              name="encerramentoConteudo"
              placeholder="Descreva o encerramento do encontro..."
              rows="4"></textarea>
          </div>
        </section>

      </ng-container>
    </form>
  </div>

  <!-- Modal de Templates -->
  <app-mentoria-templates-modal
    *ngIf="mostrarModalTemplates"
    (close)="fecharModalTemplates()"
    (templateSelecionado)="aplicarTemplate($event)">
  </app-mentoria-templates-modal>
</div>