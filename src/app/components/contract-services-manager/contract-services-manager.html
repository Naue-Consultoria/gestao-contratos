<div class="services-manager">
  <!-- Progress Bar Section -->
  <div class="tasks-progress-section" *ngIf="services && services.length > 0">
    <div class="progress-header">
      <h3 class="progress-title">
        <i class="fas fa-chart-line"></i>
        Progresso das Tarefas
      </h3>
      <div class="progress-stats">
        <span class="progress-text">{{ getTasksProgress() }}% concluído</span>
      </div>
    </div>
    <div class="progress-bar-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="getTasksProgress()"></div>
      </div>
    </div>
  </div>

  <div class="services-table">
    <div class="table-header-row">
      <div class="col-service">Serviço</div>
      <div class="col-status">Status</div>
      <div class="col-date">Data Agendada</div>
      <div class="col-progress">Progresso</div>
      <div class="col-actions">Acompanhamento</div>
    </div>
    
    <div *ngFor="let service of services" class="service-row">
      <div class="col-service">
        <div class="service-info">
          <h4 class="service-name">{{ service.service.name }}</h4>
          <span class="service-category">{{ service.service.category || 'Geral' }}</span>
        </div>
      </div>
      
      <div class="col-status">
        <!-- Edit Mode -->
        <div class="status-controls" *ngIf="isEditMode()">
          <select 
            [(ngModel)]="service.status" 
            (ngModelChange)="updateServiceStatus(service, $event)"
            class="status-select">
            <option *ngFor="let status of serviceStatuses" [value]="status.value">
              {{ status.label }}
            </option>
          </select>
        </div>
        
        <!-- View Mode -->
        <div class="status-display" *ngIf="!isEditMode()">
          <span class="status-badge" [style.background-color]="getStatusColor(getRoutineStatus(service))">
            <i [class]="getStatusIcon(getRoutineStatus(service))"></i>
            {{ getStatusText(getRoutineStatus(service)) }}
          </span>
        </div>
      </div>
      
      <div class="col-date">
        <!-- Edit Mode -->
        <div class="date-controls" *ngIf="isEditMode()">
          <input 
            type="date" 
            [value]="service.scheduled_start_date || ''"
            (change)="updateServiceDate(service, $event)"
            class="date-input"
            placeholder="Selecionar data">
        </div>
        
        <!-- View Mode -->
        <div class="date-display" *ngIf="!isEditMode()">
          <span class="date-text" *ngIf="getRoutineDate(service)">
            <i class="fas fa-calendar-alt"></i>
            {{ formatDate(getRoutineDate(service)) }}
          </span>
          <span class="date-text no-date" *ngIf="!getRoutineDate(service)">
            <i class="fas fa-calendar"></i>
            Não agendado
          </span>
        </div>
      </div>
      
      <div class="col-progress">
        <div class="progress-display">
          <div *ngIf="isLoadingProgress(service.service.id)" class="progress-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <span class="loading-text">Carregando...</span>
          </div>
          <div *ngIf="!isLoadingProgress(service.service.id)" class="service-progress">
            <div class="progress-bar-small">
              <div class="progress-fill-small" [style.width.%]="getServiceProgressPercentage(service.service.id)"></div>
            </div>
            <span class="progress-percentage">{{ getServiceProgressPercentage(service.service.id) }}%</span>
          </div>
        </div>
      </div>
      
      <div class="col-actions">
        <div class="tracking-action">
          <button 
            type="button"
            (click)="navigateToServiceTracking(service, $event)"
            class="tracking-btn"
            title="Acompanhar serviço">
            <div class="tracking-icon-wrapper">
              <i class="fas fa-chart-line"></i>
            </div>
            <span class="tracking-label">Acompanhar</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>