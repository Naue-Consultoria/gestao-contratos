<div class="page">
  <div class="page-header">
    <h1 class="page-title">Serviços</h1>
    <app-breadcrumb></app-breadcrumb>
  </div>

  <div class="table-container">
    <div class="table-header">
      <h2 class="table-title">Lista de Serviços</h2>
      
      <div class="center-controls">
        <!-- Filtro por categoria -->
        <div class="category-filter">
          <select
            class="form-select"
            [(ngModel)]="selectedCategory"
            (change)="applyFilters()"
          >
            <option value="">Todas as Categorias</option>
            <option *ngFor="let category of availableCategories" [value]="category">
              {{ category }}
            </option>
          </select>
        </div>
        
        <!-- Barra de pesquisa -->
        <div class="search-input-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input 
            type="text" 
            class="search-input" 
            placeholder="Buscar serviços..." 
            [(ngModel)]="searchTerm"
            (input)="applyFilters()"
          />
          <button 
            *ngIf="searchTerm" 
            class="clear-search-btn" 
            (click)="clearSearch()"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <button class="btn btn-primary" (click)="openNewServicePage()">
        <i class="fas fa-plus"></i>
        Novo Serviço
      </button>
    </div>

    <!-- Mensagem de erro -->
    <div *ngIf="error" class="error-message">
      <i class="fas fa-exclamation-circle"></i>
      {{ error }}
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-container">
      <i class="fas fa-spinner fa-spin"></i>
      Carregando serviços...
    </div>

    <!-- Tabela -->
    <div class="table-wrapper" *ngIf="!isLoading">
      <!-- Mensagem quando não há serviços -->
      <div *ngIf="filteredServices.length === 0 && services.length === 0 && !error" class="empty-state">
        <i class="fas fa-briefcase empty-icon"></i>
        <h3>Nenhum serviço cadastrado</h3>
        <p>Clique no botão "Novo Serviço" para adicionar o primeiro serviço.</p>
      </div>

      <!-- Mensagem quando não há resultados na busca -->
      <div *ngIf="filteredServices.length === 0 && services.length > 0 && !error" class="empty-state">
        <i class="fas fa-search empty-icon"></i>
        <h3>Nenhum serviço encontrado</h3>
        <p>Tente ajustar os filtros ou termo de busca.</p>
        <button class="btn btn-secondary" (click)="clearFilters()">Limpar Filtros</button>
      </div>

      <!-- Tabela de serviços -->
      <table class="custom-table" *ngIf="filteredServices.length > 0">
        <thead>
          <tr>
            <th>Nome do Serviço</th>
            <th>Categoria</th>
            <th>Duração</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let service of filteredServices"
            class="clickable"
            (click)="editService(service.id)"
          >
            <td>
              <div class="service-info">
                <div class="service-icon" [class.inactive]="!service.isActive">
                  <i [class]="getCategoryIcon(service.category)"></i>
                </div>
                <span class="service-name" [class.inactive]="!service.isActive"
                  >{{ service.name }}</span
                >
              </div>
            </td>
            <td>
              <span
                class="category-badge"
                [attr.data-category]="service.category"
              >
                {{ service.category }}
              </span>
            </td>
            <td>
              <div class="duration-info">
                <i class="fas fa-clock"></i>
                {{ service.duration }}
              </div>
            </td>
            <td>
              <div
                class="status-toggle"
                (click)="toggleServiceStatus(service, $event)"
              >
                <span
                  class="status-badge"
                  [class.active]="service.isActive"
                  [class.inactive]="!service.isActive"
                >
                  {{ service.isActive ? 'Ativo' : 'Inativo' }}
                </span>
              </div>
            </td>
            <td>
              <button
                class="action-btn"
                (click)="duplicateService(service, $event)"
                title="Duplicar serviço"
              >
                <i class="fas fa-copy"></i>
              </button>
              <button
                class="action-btn"
                (click)="editService(service.id); $event.stopPropagation()"
                title="Editar serviço"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button
                class="action-btn action-btn-danger"
                (click)="deleteService(service, $event)"
                title="Excluir serviço"
              >
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal de duplicação -->
<app-duplicate-service-modal
  [service]="selectedServiceForDuplication"
  [show]="showDuplicateModal"
  (close)="onDuplicateModalClose()"
  (serviceDuplicated)="onServiceDuplicated($event)"
></app-duplicate-service-modal>
