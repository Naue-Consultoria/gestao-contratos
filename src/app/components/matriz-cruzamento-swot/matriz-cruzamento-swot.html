<div class="page-header-wrapper">
  <div class="page-header">
    <h1 class="page-title">Definição de Impacto - Cenários</h1>
    <button class="btn btn-secondary" (click)="voltarParaPlanejamento()">
      <i class="fas fa-arrow-left"></i> Voltar
    </button>
  </div>
  <app-breadcrumb></app-breadcrumb>
</div>

<div *ngIf="error" class="error-message">
  <i class="fas fa-exclamation-circle"></i>
  {{ error }}
</div>

<div *ngIf="isLoading" class="loading-container">
  <i class="fas fa-spinner fa-spin"></i>
  Carregando...
</div>

<div *ngIf="!isLoading && planejamento" class="content">
  <!-- Empty State -->
  <div *ngIf="!matrizFinal || oportunidades.length === 0 || ameacas.length === 0 || forcas.length === 0 || fraquezas.length === 0" class="empty-state">
    <i class="fas fa-exclamation-triangle empty-icon"></i>
    <h3>Matriz SWOT Consolidada necessária</h3>
    <p>Para criar a matriz de cruzamento, é necessário primeiro criar a <strong>Matriz SWOT Consolidada</strong> com todos os quadrantes preenchidos (Forças, Fraquezas, Oportunidades e Ameaças).</p>
    <div class="empty-actions">
      <button class="btn btn-primary" (click)="irParaMatrizConsolidada()">
        <i class="fas fa-th"></i> Ir para Matriz SWOT Consolidada
      </button>
      <button class="btn btn-secondary" (click)="voltarParaPlanejamento()">
        <i class="fas fa-arrow-left"></i> Voltar ao Planejamento
      </button>
    </div>
  </div>

  <!-- Matriz de Cruzamento -->
  <div *ngIf="oportunidades.length > 0 && ameacas.length > 0 && forcas.length > 0 && fraquezas.length > 0" class="matriz-container">

    <!-- Botões de ação -->
    <div class="action-bar">
      <div class="cliente-info">
        {{ getClientName() }}
      </div>
      <div class="action-buttons">
        <button class="btn btn-secondary" (click)="irParaAnalise()" *ngIf="matrizCruzamento">
          <i class="fas fa-chart-bar"></i> Ver Análise
        </button>
        <button class="btn btn-primary" (click)="salvarMatrizCruzamento()" [disabled]="isSaving">
          <i class="fas fa-save"></i> {{ isSaving ? 'Salvando...' : 'Salvar Matriz' }}
        </button>
      </div>
    </div>

    <!-- Wrapper da Matriz -->
    <div class="matriz-wrapper-master">
      <!-- Headers dos Quadrantes -->
      <div class="headers-row">
        <div class="header-spacer"></div>
        <div class="quadrante-title">RESTRIÇÕES</div>
        <div class="quadrante-title">ALAVANCAS</div>
      </div>

      <!-- Linha de Oportunidades -->
      <div class="matriz-data-row">
        <!-- Label Oportunidades -->
        <div class="row-label oportunidades-label">
          <div class="row-label-titulo">OPORTUNIDADES</div>
          <div class="row-label-items">
            <div *ngFor="let item of oportunidades; trackBy: trackByIndex" class="row-label-item">
              {{ item }}
            </div>
          </div>
        </div>

        <!-- Grid Restrições -->
        <div class="cells-grid restricoes-grid">
          <div *ngFor="let linha of restricoes; let i = index; trackBy: trackByIndex" class="cells-row">
            <input *ngFor="let val of linha; let j = index; trackBy: trackByIndex"
              type="number" [(ngModel)]="restricoes[i][j]"
              min="0" max="50" step="10"
              class="cell-input" (blur)="validarCelula(restricoes, i, j)" />
          </div>
        </div>

        <!-- Grid Alavancas -->
        <div class="cells-grid alavancas-grid">
          <div *ngFor="let linha of alavancas; let i = index; trackBy: trackByIndex" class="cells-row">
            <input *ngFor="let val of linha; let j = index; trackBy: trackByIndex"
              type="number" [(ngModel)]="alavancas[i][j]"
              min="0" max="50" step="10"
              class="cell-input" (blur)="validarCelula(alavancas, i, j)" />
          </div>
        </div>
      </div>

      <!-- Headers Linha 2 -->
      <div class="headers-row">
        <div class="header-spacer"></div>
        <div class="quadrante-title">PROBLEMAS</div>
        <div class="quadrante-title">DEFESAS</div>
      </div>

      <!-- Linha de Ameaças -->
      <div class="matriz-data-row">
        <!-- Label Ameaças -->
        <div class="row-label ameacas-label">
          <div class="row-label-titulo">AMEAÇAS</div>
          <div class="row-label-items">
            <div *ngFor="let item of ameacas; trackBy: trackByIndex" class="row-label-item">
              {{ item }}
            </div>
          </div>
        </div>

        <!-- Grid Problemas -->
        <div class="cells-grid problemas-grid">
          <div *ngFor="let linha of problemas; let i = index; trackBy: trackByIndex" class="cells-row">
            <input *ngFor="let val of linha; let j = index; trackBy: trackByIndex"
              type="number" [(ngModel)]="problemas[i][j]"
              min="0" max="50" step="10"
              class="cell-input" (blur)="validarCelula(problemas, i, j)" />
          </div>
        </div>

        <!-- Grid Defesas -->
        <div class="cells-grid defesas-grid">
          <div *ngFor="let linha of defesas; let i = index; trackBy: trackByIndex" class="cells-row">
            <input *ngFor="let val of linha; let j = index; trackBy: trackByIndex"
              type="number" [(ngModel)]="defesas[i][j]"
              min="0" max="50" step="10"
              class="cell-input" (blur)="validarCelula(defesas, i, j)" />
          </div>
        </div>
      </div>

      <!-- Footers (Fraquezas e Forças) -->
      <div class="footers-row">
        <div class="footer-spacer"></div>
        <div class="column-footer fraquezas-footer">
          <div class="footer-titulo">FRAQUEZAS</div>
          <div class="footer-items">
            <div *ngFor="let item of fraquezas; trackBy: trackByIndex" class="footer-item">
              {{ item }}
            </div>
          </div>
        </div>
        <div class="column-footer forcas-footer">
          <div class="footer-titulo">FORÇAS</div>
          <div class="footer-items">
            <div *ngFor="let item of forcas; trackBy: trackByIndex" class="footer-item">
              {{ item }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Legenda -->
    <div class="legenda">
      <h4>Nível de Impacto</h4>
      <div class="legenda-items">
        <div class="legenda-item"><span class="legenda-valor">0</span> - Nulo</div>
        <div class="legenda-item"><span class="legenda-valor">10</span> - Muito baixo</div>
        <div class="legenda-item"><span class="legenda-valor">20</span> - Baixo</div>
        <div class="legenda-item"><span class="legenda-valor">30</span> - Médio</div>
        <div class="legenda-item"><span class="legenda-valor">40</span> - Alto</div>
        <div class="legenda-item"><span class="legenda-valor">50</span> - Muito alto</div>
      </div>
    </div>
  </div>
</div>
