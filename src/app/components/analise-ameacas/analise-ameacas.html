<div class="page-header-wrapper">
  <div class="page-header">
    <h1 class="page-title">Análise de Ameaças</h1>
    <button class="btn btn-secondary" (click)="voltarParaAnaliseCenarios()">
      <i class="fas fa-arrow-left"></i> Voltar
    </button>
  </div>
  <app-breadcrumb></app-breadcrumb>
</div>

<div *ngIf="error" class="error-message">
  <i class="fas fa-exclamation-circle"></i>
  {{ error }}
</div>

<div *ngIf="isLoading" class="loading-container">
  <i class="fas fa-spinner fa-spin"></i>
  Carregando...
</div>

<div *ngIf="!isLoading && planejamento" class="content">
  <div *ngIf="!matrizCruzamento || !matrizFinal" class="empty-state">
    <i class="fas fa-exclamation-triangle empty-icon"></i>
    <h3>Definição de Impacto necessária</h3>
    <p>Para visualizar a análise, é necessário preencher a Definição de Impacto.</p>
    <button class="btn btn-primary" (click)="voltarParaAnaliseCenarios()">
      <i class="fas fa-arrow-left"></i> Voltar para Análise de Cenários
    </button>
  </div>

  <div *ngIf="matrizCruzamento && matrizFinal && analiseItems.length > 0" class="analise-container">
    <div class="cliente-header">
      <h2>{{ getClientName() }}</h2>
    </div>

    <div class="analise-content-single">
      <div class="charts-section">
        <h3 class="section-title">Análise Gráfica</h3>

        <div class="charts-grid">
          <div class="chart-box">
            <h4 class="chart-subtitle">Distribuição por FRAQUEZA</h4>
            <div class="chart-container-pie">
              <canvas id="chartFraquezas"></canvas>
            </div>
          </div>

          <div class="chart-box">
            <h4 class="chart-subtitle">Distribuição por FORÇA</h4>
            <div class="chart-container-pie">
              <canvas id="chartForcas"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Gráficos Individuais por Ameaça -->
      <div class="graficos-individuais-section">
        <h3 class="section-title">Análise Individual por Ameaça</h3>

        <div *ngFor="let item of analiseItems; let i = index" class="item-individual">
          <h4 class="item-title">{{ i + 1 }}. {{ item.texto }}</h4>

          <div class="item-charts-grid">
            <div class="chart-box-small">
              <h5 class="chart-subtitle-small">Distribuição FRAQUEZAS</h5>
              <div class="chart-container-small">
                <canvas [id]="'chartFraqueza' + i"></canvas>
              </div>
            </div>

            <div class="chart-box-small">
              <h5 class="chart-subtitle-small">Distribuição FORÇAS</h5>
              <div class="chart-container-small">
                <canvas [id]="'chartForca' + i"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
