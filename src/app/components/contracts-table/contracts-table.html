<div class="page">
  <div class="page-header">
    <h1 class="page-title">Gestão de Contratos</h1>
    <app-breadcrumb></app-breadcrumb>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab" [class.active]="currentTab === 'all'" (click)="changeTab('all')">
      Todos os Contratos
      <span class="tab-count">{{ contracts.length }}</span>
    </div>
    <div class="tab" [class.active]="currentTab === 'Full'" (click)="changeTab('Full')">
      Contratos Full
      <span class="tab-count">{{ stats.typeStats.Full }}</span>
    </div>
    <div class="tab" [class.active]="currentTab === 'Pontual'" (click)="changeTab('Pontual')">
      Contratos Pontuais
      <span class="tab-count">{{ stats.typeStats.Pontual }}</span>
    </div>
    <div class="tab" [class.active]="currentTab === 'Individual'" (click)="changeTab('Individual')">
      Mentorias Individuais
      <span class="tab-count">{{ stats.typeStats.Individual }}</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="table-container">
    <!-- Filters and Actions -->
    <div class="table-header">
      <div class="filters-section">
        <div class="search-box">
          <i class="fas fa-search search-icon"></i>
          <input 
            type="text" 
            class="search-input" 
            placeholder="Buscar por número ou empresa..."
            [(ngModel)]="filters.search"
            (input)="applyFilters()">
        </div>
        
        <div class="filter-group">
          <select class="filter-select" [(ngModel)]="filters.status" (change)="applyFilters()">
            <option value="">Todos os status</option>
            <option value="active">Ativo</option>
            <option value="completed">Concluído</option>
            <option value="cancelled">Cancelado</option>
            <option value="suspended">Suspenso</option>
          </select>
          
          <select class="filter-select" [(ngModel)]="filters.client_id" (change)="applyFilters()">
            <option [value]="null">Todos os clientes</option>
            <option *ngFor="let client of clients" [value]="client.id">{{ client.name }}</option>
          </select>
        </div>
        
        <button class="btn btn-secondary btn-clear" (click)="clearFilters()" *ngIf="filters.search || filters.status || filters.client_id">
          <i class="fas fa-times"></i>
          <span class="btn-text">Limpar filtros</span>
        </button>
      </div>
      
      <div class="action-buttons btn-group">
        <button class="btn btn-primary btn-new" (click)="openNewContractPage()">
          <i class="fas fa-plus-circle"></i>
          <span class="btn-text">Novo Contrato</span>
        </button>
      </div>
    </div>
    
    <!-- Error Message -->
    <div *ngIf="error" class="error-message">
      <i class="fas fa-exclamation-circle"></i>
      {{ error }}
    </div>
    
    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-container">
      <i class="fas fa-spinner fa-spin"></i>
      Carregando contratos...
    </div>
    
    <!-- Table -->
    <div class="table-wrapper" *ngIf="!isLoading">
      <!-- Empty State -->
      <div *ngIf="filteredContracts.length === 0 && !error" class="empty-state">
        <i class="fas fa-file-contract empty-icon"></i>
        <h3>Nenhum contrato encontrado</h3>
        <p *ngIf="filters.search || filters.status || filters.client_id">
          Tente ajustar os filtros de busca
        </p>
        <p *ngIf="!filters.search && !filters.status && !filters.client_id">
          Clique no botão "Novo Contrato" para criar o primeiro contrato
        </p>
      </div>
      
      <!-- Contracts Table - Desktop -->
      <table class="contracts-table" *ngIf="filteredContracts.length > 0">
        <thead>
          <tr>
            <th>Número</th>
            <th>Cliente</th>
            <th>Tipo</th>
            <th class="text-center">Serviços</th>
            <th>Data de Término</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let contract of filteredContracts">
            <td>
              <div class="contract-number">
                {{ contract.contractNumber }}
              </div>
            </td>
            <td>
              <div class="client-info">
                <i class="fas fa-user-circle"></i>
                {{ contract.clientName }}
              </div>
            </td>
            <td>
              <div class="contract-type">
                <i [class]="getTypeIcon(contract.type)"></i>
                <span class="type-badge" [attr.data-type]="contract.type">
                  {{ contract.type }}
                </span>
              </div>
            </td>
            <td class="text-center"> <div class="services-count">
                <span class="services-badge">
                  {{ contract.servicesCount }} serviço{{ contract.servicesCount !== 1 ? 's' : '' }}
                </span>
              </div>
            </td>
            <td>
              <div class="end-date">
                <i class="fas fa-calendar-times"></i>
                <span *ngIf="contract.endDate; else noEndDate">
                  {{ contract.endDate }}
                </span>
                <ng-template #noEndDate>
                  <span class="no-end-date">Indeterminado</span>
                </ng-template>
              </div>
            </td>
            <td>
              <div class="status-container">
                <span class="status-badge" [style.background-color]="contract.statusColor + '20'" [style.color]="contract.statusColor">
                  <span class="status-dot" [style.background-color]="contract.statusColor"></span>
                  {{ contract.status }}
                </span>
              </div>
            </td>
            <td>
              <div class="action-buttons-cell">
                <button class="action-btn edit" (click)="editContract(contract.id, $event)" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete" (click)="deleteContract(contract.id, $event)" title="Excluir">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Contracts Cards - Mobile -->
      <div class="table-card-mode" *ngIf="filteredContracts.length > 0">
        <div *ngFor="let contract of filteredContracts" class="table-card">
          <div class="table-card-header">
            <div class="contract-number">{{ contract.contractNumber }}</div>
            <span class="status-badge" [style.background-color]="contract.statusColor + '20'" [style.color]="contract.statusColor">
              <span class="status-dot" [style.background-color]="contract.statusColor"></span>
              {{ contract.status }}
            </span>
          </div>
          <div class="table-card-content">
            <div class="table-card-row">
              <span class="table-card-label">Cliente:</span>
              <span class="table-card-value">{{ contract.clientName }}</span>
            </div>
            <div class="table-card-row">
              <span class="table-card-label">Tipo:</span>
              <span class="table-card-value">
                <span class="type-badge" [attr.data-type]="contract.type">
                  <i [class]="getTypeIcon(contract.type)"></i>
                  {{ contract.type }}
                </span>
              </span>
            </div>
            <div class="table-card-row">
              <span class="table-card-label">Serviços:</span>
              <span class="table-card-value">
                <span class="services-badge">
                  {{ contract.servicesCount }} serviço{{ contract.servicesCount !== 1 ? 's' : '' }}
                </span>
              </span>
            </div>
            <div class="table-card-row">
              <span class="table-card-label">
                <i class="fas fa-calendar-times"></i> Data de Término:
              </span>
              <span class="table-card-value">
                <span *ngIf="contract.endDate; else noEndDateMobile">
                  {{ contract.endDate }}
                </span>
                <ng-template #noEndDateMobile>
                  <span class="no-end-date">Indeterminado</span>
                </ng-template>
              </span>
            </div>
          </div>
          <div class="table-card-actions">
            <button class="btn-sm btn-primary" (click)="editContract(contract.id, $event)">
              <i class="fas fa-edit"></i>
              Editar
            </button>
            <button class="btn-sm btn-danger" (click)="deleteContract(contract.id, $event)">
              <i class="fas fa-trash"></i>
              Excluir
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>