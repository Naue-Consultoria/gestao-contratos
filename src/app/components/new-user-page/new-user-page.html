<div class="page-header">
  <h1 class="page-title">{{ isEditMode ? 'Editar Usuário' : 'Novo Usuário' }}</h1>
  <app-breadcrumb></app-breadcrumb>
</div>

<div class="table-container">
  <div class="error-message" *ngIf="errorMessage">
    <i class="fas fa-exclamation-circle"></i>
    <span>{{ errorMessage }}</span>
  </div>

  <form class="user-form" (ngSubmit)="saveUser()" #userForm="ngForm">
    <div class="form-section">
      <h2 class="section-title">
        <i class="fas fa-info-circle"></i>
        Informações Básicas
      </h2>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">
            Nome Completo <span class="required">*</span>
          </label>
          <input 
            type="text" 
            class="form-control" 
            [(ngModel)]="userData.name"
            name="name"
            placeholder="Digite o nome completo"
            [class.error]="errors['name']"
            required>
          <span class="field-error" *ngIf="errors['name']">{{ errors['name'] }}</span>
        </div>

        <div class="form-group">
          <label class="form-label">
            Email <span class="required">*</span>
          </label>
          <input 
            type="email" 
            class="form-control" 
            [(ngModel)]="userData.email"
            name="email"
            placeholder="email@exemplo.com"
            [class.error]="errors['email']"
            [disabled]="isEditMode"
            required>
          <span class="field-error" *ngIf="errors['email']">{{ errors['email'] }}</span>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Perfil de Acesso</label>
          <select 
            class="form-control" 
            [(ngModel)]="userData.role"
            name="role">
            <option value="" disabled>Selecione um perfil</option>
            <option value="user">Usuário</option>
            <option value="admin">Administrador</option>
          </select>
        </div>
      </div>

      <div class="info-box" *ngIf="!isEditMode">
          <p>Ao criar um novo usuário, uma senha temporária segura será gerada e enviada para o e-mail cadastrado. O usuário será solicitado a criar uma nova senha em seu primeiro login.</p>
      </div>
    </div>
    
    <div class="form-section">
      <h2 class="section-title">
        <i class="fas fa-user-circle"></i>
        Foto de Perfil (Opcional)
      </h2>
      <div class="form-grid">
        <div class="form-group">
          <div class="profile-picture-upload">
            <div class="current-picture" *ngIf="profilePictureUrl">
              <img [src]="profilePictureUrl" alt="Foto de perfil atual" class="profile-preview">
              <button type="button" class="remove-picture-btn" (click)="removeProfilePicture()" [disabled]="isLoading">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="upload-area">
              <input type="file" 
                     id="profilePicture" 
                     accept="image/*" 
                     (change)="onProfilePictureSelected($event)"
                     [disabled]="isLoading"
                     #fileInput>
              <label for="profilePicture" class="upload-label">
                <i class="fas fa-camera"></i>
                {{ profilePictureUrl ? 'Alterar foto' : 'Selecionar foto' }}
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="form-actions">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="cancel()">
        <i class="fas fa-times"></i>
        Cancelar
      </button>
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="isLoading">
        <i class="fas fa-check" *ngIf="!isLoading"></i>
        <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
        {{ isEditMode ? 'Atualizar' : 'Salvar' }}
      </button>
    </div>
  </form>
</div>